// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(x,n,u,d,b,c,g,a,f,h,m,e,k,q){var l=h.defaults.map.zoomDuration;return x([q],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:
!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>b("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&
this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;g.set(this._div,f._css.names.transform,f._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(n.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),
0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new k((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var e=this._div=c.create("div",null,b),d={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(d[f._css.names.transform]=f._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;g.set(e,d);this._canvas=c.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},e);m.isDefined(this.opacity)&&g.set(e,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(u.connect(a,"onPan",this,this._panHandler));this._connects.push(u.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(u.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(u.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(u.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(u.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(u.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(u.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(u.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var h=u.connect(a,"onLoad",this,function(){u.disconnect(h);h=null;this.evaluateSuspension()});return e},_unsetMap:function(a,b){d.forEach(this._connects,u.disconnect,this);var f=this._div;f&&(b.removeChild(f),c.destroy(f));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==
a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,g.set(this._div,f._css.names.transform,f._css.translate(this._left,this._top)),g.set(this._canvas,f._css.names.transform,f._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&
this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());var e=this.pixelData.extent,d=this._map.extent,h=this.getCurrentResolution(),k=0,w=0;Math.abs(e.xmin-d.xmin)>h.x&&(k=Math.round((e.xmin-d.xmin)/h.x));Math.abs(d.ymax-e.ymax)>h.y&&(w=Math.round((d.ymax-e.ymax)/h.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,g.set(this._div,f._css.names.transform,f._css.translate(this._left,this._top)),g.set(this._canvas,f._css.names.transform,f._css.translate(-this._left,-this._top))):(g.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),g.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(c,k,w,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()},
_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,g.set(this._div,f._css.names.transform,f._css.translate(this._left,this._top))):g.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(b,c){var e={},d=f._css.names;g.set(this._canvas,d.transition,c?"none":
d.transformName+" "+l+"ms ease");this._matrix=b;b=this._multiply?a.multiply(b,this._multiply):b;if(this._tdx||this._tdy)b=a.multiply(b,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});e[d.transform]=f._css.matrix(b);g.set(this._canvas,e)},_onZoomHandler:function(a,b,f){var c=this._startRect;a=c.width*b;b*=c.height;var e=c.left-(a-c.width)*(f.x-c.left)/c.width;f=c.top-(b-c.height)*(f.y-c.top)/c.height;g.set(this._canvas,{left:e+"px",top:f+"px",width:a+"px",height:b+"px"});this._endRect={left:e,top:f,
width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,f){g.set(this._div,{width:b+"px",height:f+"px"});g.set(this._canvas,{width:b+"px",height:f+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=f},_extentChangeHandler:function(b,c,e,d){this.suspended||c&&0===c.x&&0===c.y&&!e||("css-transforms"===this._map.navigationMode&&(c&&(this._dragOrigin.x+=c.x,this._dragOrigin.y+=c.y),e||(this._left=
this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,g.set(this._div,f._css.names.transform,f._css.translate(this._left,this._top))),e&&(g.set(this._canvas,f._css.names.transition,"none"),this._multiply=this._multiply?a.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),b=this._map,this._requestData(b.extent,b.width,b.height))},_visibilityChangeHandler:function(a){a?e.show(this._div):e.hide(this._div)},_opacityChangeHandler:function(a){g.set(this._div,"opacity",
a)}})})},"esri/layers/WCSConnection":function(){define("dojo/_base/declare dojo/_base/lang dojo/io-query dojo/has dojo/_base/Deferred dojo/DeferredList ../deferredUtils ../request ../kernel ./WCSCapabilities ./WCSCoverageDescription".split(" "),function(x,n,u,d,b,c,g,a,f,h,m){var e=function(a,b,c){var f;if(c)for(f=0;f<a.length;f++){if(a[f][c].toLowerCase()===b.toLowerCase())return a[f]}else for(f=0;f<a.length;f++)if(a[f].toLowerCase()===b.toLowerCase())return a[f]};x=x(null,{declaredClass:"esri.layers.WCSConnection",
url:null,supportedVersions:["1.0.0","1.1.0","1.1.1","2.0.1"],version:null,name:null,onlineResources:null,coverages:null,supportedFormats:null,profiles:null,supportedInterpolations:null,onConnected:null,constructor:function(a,b){if(a){var f=a.indexOf("?");-1<f&&f<=a.length-1?(this.optionalParameters=u.queryToObject(a.substring(f+1,a.length)),this.url=a.substring(0,f+1)):this.url=a}this.optionalParameters=this.optionalParameters||{};b&&n.mixin(this.optionalParameters,b);this.optionalParameters.version&&
(this.version=this.optionalParameters.version);var c=this.optionalParameters;Object.keys(c).forEach(function(a){c[a]||delete c[a]});this.connect=n.hitch(this,this.connect);this.url&&this.connect(this.version)},_getCapabilities:function(f){var c=new b,e=n.mixin({},this.optionalParameters),g=["service","request","coverageId","coverage","identifier"];Object.keys(e).forEach(function(a){g.some(function(b){return b.toLowerCase()===a.toLowerCase()})&&delete e[a]});a({url:this.url,content:n.mixin({request:"GetCapabilities",
service:"WCS",version:f,AcceptVersions:f},e),handleAs:"xml"}).then(n.hitch(this,function(a){a=new h(a);c.resolve(a)}),function(a){c.reject(a)});return c.promise},_getCapabilitiesHelper:function(a){var f;if(a)f=this._getCapabilities(a);else{var c=new b;f=c.promise;a=-1<this.url.toLowerCase().indexOf("wcsserver")?"2.0.1":"1.0.0";this._getCapabilities(a).then(n.hitch(this,function(a){!this.version&&-1<this.url.toLowerCase().indexOf("wcsserver")?1===a.supportedVersions.length&&"2.0.1"===a.supportedVersions[0]?
this._getCapabilities().then(n.hitch(this,function(a){c.resolve(a)}),n.hitch(this,function(a){c.reject(a)})):c.resolve(a):c.resolve(a)}),n.hitch(this,function(a){c.reject(a)}))}return f},_describeCoverage:function(){var f=new b,g=this.coverageId||this.optionalParameters.coverage||this.optionalParameters.coverageId||this.optionalParameters.identifiers||this.coverages.map(function(a){return a.id}).join(","),d=this.version,h={request:"DescribeCoverage",service:"WCS",version:d};switch(d){case "1.0.0":h=
n.mixin(h,{coverage:g});break;case "1.1.0":case "1.1.1":case "1.1.2":h=n.mixin(h,{identifiers:g});break;case "2.0.1":h=n.mixin(h,{coverageId:g})}var m=n.mixin({},this.optionalParameters),r=["service","request"];Object.keys(m).forEach(function(a){r.some(function(b){return b.toLowerCase()===a.toLowerCase()})&&delete m[a]});var t=a({url:this._onlineResources?this._onlineResources.describeCoverage:this.url,content:n.mixin(h,m),handleAs:"xml"});"2.0.1"===d&&(d=g,-1<g.indexOf(",")?d=g.split(",").map(function(a){return 0===
a.toLowerCase().indexOf("coverage")?a.slice(8):a}).join(","):0===g.toLowerCase().indexOf("coverage")&&(d=g.slice(8)),g=a({url:this._onlineResources?this._onlineResources.describeCoverage:this.url,content:n.mixin(h,m,{identifiers:d,version:"1.1.1"}),handleAs:"xml"}),t=new c([t,g]));t.then(n.hitch(this,function(a){var b;if("2.0.1"===this.version){if(b=a[0][0]&&a[0][1]?this._parseCoverageDescriptions(a[0][1],this.version):null,(a=a[1][0]&&a[1][1]?this._parseCoverageDescriptions(a[1][1],"1.1.1"):null)&&
a.length){var c,g,d,h,m,k,l,p,t;for(l=0;l<b.length;l++)if(c=b[l].multidimensionalInfo,g=a[l].multidimensionalInfo,c&&g)for(t=0;t<c.variables.length;t++)if(d=c.variables[t],h=e(g.variables,d.name,"name"))for(p=0;p<d.dimensions.length;p++)if(m=d.dimensions[p],k=e(h.dimensions,m.name,"name"))m.values=m.values||k.values,m.values&&(m.hasRegularIntervals=!1)}}else b=this._parseCoverageDescriptions(a,this.version);f.resolve(b)}),function(a){f.reject(a)});return f.promise},_parseCoverageDescriptions:function(a,
b){var f,c=[];a="1.0.0"===b?a.getElementsByTagNameNS("*","CoverageOffering"):a.getElementsByTagNameNS("*","CoverageDescription");for(f=0;f<a.length;f++)c.push(new m(a[f],b));return c},connect:function(a){var f=new b(function(){return"cancelled"});this._connectPromise&&this._connectPromise.cancel();this.version=(a=a||this.version)||this.version;var c=function(a){f.reject(a);this._connectPromise=null;if(this.onConnectionFailed)this.onConnectionFailed(a)};this._getCapabilitiesHelper(a).then(n.hitch(this,
function(a){if(!f.isCanceled()){this.supportedInterpolations=a.supportedInterpolations;this.supportedVersions=a.supportedVersions;-1<this.url.toLowerCase().indexOf("wcsserver")?("2.0.1"===this.supportedVersions[0]&&1===this.supportedVersions.length&&(this.supportedVersions=["1.0.0","1.1.0","1.1.1","2.0.1"]),this.version=this.version||this.supportedVersions.reduce(function(a,b){return a>b?a:b})):this.version=this.version||"1.0.0";this.name=this.name||a.name;this.version=this.version||a.version;this.onlineResources=
this.onlineResources||a.onlineResources;this.coverages=this.coverages||a.coverages;if(void 0===this.coverages||null===this.coverages||0===this.coverages.length)throw"No valid coverages";this.supportedFormats=this.supportedFormats||a.supportedFormats;this.profiles=this.profiles||a.profiles;this._describeCoverage().then(n.hitch(this,function(a){if(!f.isCanceled())if(a){if(a.forEach(n.hitch(this,function(a){a.lonLatEnvelope=e(this.coverages,a.id,"id").lonLatEnvelope||a.lonLatEnvelope})),this.coverages=
a,f.resolve(this),this._connectPromise=null,this.onConnected)this.onConnected()}else c("cannot parse coverage descriptions")}),c)}}),c);return this._connectPromise=f.promise}});d("extend-esri")&&n.setObject("layers.WCSConnection",x,f);return x})},"esri/layers/WCSCapabilities":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Extent"],function(x,n,u,d,b){var c=function(b,a){if(null===b||null===a||null===b.tagName||void 0===b.tagName)return!1;b=b.tagName.toLowerCase();
a=a.toLowerCase();return b===a||0<b.indexOf(":"+a)};x=x(null,{declaredClass:"esri.layers.WCSCapabilities",version:null,name:null,onlineResources:null,coverages:null,supportedFormats:null,supportedVersions:null,profiles:null,supportedInterpolations:null,constructor:function(b){this._parse=n.hitch(this,this._parse);b&&n.mixin(this,this._parse(b))},_parse:function(b){var a=this._getElement(b,"Capabilities")||this._getElement(b,"WCS_Capabilities");if(null===a)throw"not a valid capabilities file -- cannot find Capabilities or WCS_Capabilities root element";
this.version=a=a.getAttribute("version");switch(a){case "1.0.0":this._parse100(b);break;case "1.1.0":case "1.1.1":case "1.1.2":this._parse110(b);break;case "2.0.1":this._parse201(b);break;default:throw"unsupported WCS version "+a;}},_getElements:function(b,a){if(!b)return null;if(!a)return b;var f=a;-1<a.indexOf("/")?(f=a.slice(0,a.indexOf("/")),a=a.slice(a.indexOf("/")+1)):a="";return a?this._getElement(b,f).getElementsByTagNameNS("*",a):b.getElementsByTagNameNS("*",f)},_getElement:function(b,a){if(!b)return null;
if(!a)return b;var f=a;-1<a.indexOf("/")?(f=a.slice(0,a.indexOf("/")),a=a.slice(a.indexOf("/")+1)):a="";b=this._getElements(b,f);return 0<b.length?a?this._getElement(b[0],a):b[0]:null},_getElementValue:function(b,a){return(b=this._getElement(b,a))?(b=b.textContent||b.text||b.nodeValue||b.innerText)?b.trim():null:null},_getElementValues:function(b,a){b=this._getElements(b,a);a=[];var f,c;for(c=0;c<b.length;c++)if(f=b[c].textContent||b[c].text||b[c].nodeValue||b[c].innerText)f=f.trim(),""!==f&&a.push(f);
return a},_removeTrailingQuestionMark:function(b){return b?b.indexOf("?")===b.length-1?b.substring(0,b.length-1):b:null},_parse100:function(c){var a=this._getElement(c,"Service");this.name=this._getElementValue(a,"name");this.supportedVersions=["1.0.0"];var a={},f=this._getElement(c,"Capability");a.getCapabilities=this._removeTrailingQuestionMark(this._getElement(f,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"));a.describeCoverage=this._removeTrailingQuestionMark(this._getElement(f,
"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"));a.getCoverage=this._removeTrailingQuestionMark(this._getElement(f,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"));this.onlineResources=a;c=this._getElements(c,"CoverageOfferingBrief");for(var f=[],d,g,e,a=0;a<c.length;a++)d=c[a],g={},g.id=this._getElementValue(d,"name"),g.label=this._getElementValue(d,"label"),g.description=this._getElementValue(d,"description"),e=this._getElements(d,"pos"),d=this._getElementValue(e[0]).split(" "),
e=this._getElementValue(e[1]).split(" "),g.lonLatEnvelope=new b({xmin:parseFloat(d[0]),ymin:parseFloat(d[1]),xmax:parseFloat(e[0]),ymax:parseFloat(e[1]),spatialReference:{wkid:4326}}),f.push(g);this.coverages=f;return!0},_parse110:function(d){var a=n.hitch(this,function(f){var e,d,g,h;d={};for(g=0;g<f.childNodes.length;g++)e=f.childNodes[g],c(e,"title")?d.title=this._getElementValue(e):c(e,"abstract")?d["abstract"]=this._getElementValue(e):c(e,"identifier")?d.id=this._getElementValue(e):c(e,"WGS84BoundingBox")?
(h=this._getElementValue(e,"LowerCorner").split(" "),e=this._getElementValue(e,"UpperCorner").split(" "),d.lonLatEnvelope=new b({xmin:parseFloat(h[0]),ymin:parseFloat(h[1]),xmax:parseFloat(e[0]),ymax:parseFloat(e[1]),spatialReference:{wkid:4326}})):c(e,"CoverageSummary")&&(d.coverageSummaries=d.coverageSummaries||[],d.coverageSummaries.push(a(e)));return d}),f=function(a,b){var c;if(a.coverageSummaries)for(c=0;c<a.coverageSummaries.length;c++)a.coverageSummaries[c]["abstract"]=a.coverageSummaries[c]["abstract"]||
a["abstract"],a.coverageSummaries[c].lonLatEnvelope=a.coverageSummaries[c].lonLatEnvelope||a.lonLatEnvelope,a.coverageSummaries[c].title=a.coverageSummaries[c].title||a.title,f(a.coverageSummaries[c],b);void 0!==a.id&&b.push(a)};this.name=this._getElementValue(d,"ServiceIdentification/Title");this.supportedVersions=this._getElementValues(d,"ServiceIdentification/ServiceTypeVersion");var g={},m=this._getElement(d,"OperationsMetadata");g.getCapabilities=this._removeTrailingQuestionMark(this._getElement(m.querySelector("Operation[name\x3dGetCapabilities]"),
"Get").getAttribute("xlink:href"));g.describeCoverage=this._removeTrailingQuestionMark(this._getElement(m.querySelector("Operation[name\x3dDescribeCoverage]"),"Get").getAttribute("xlink:href"));g.getCoverage=this._removeTrailingQuestionMark(this._getElement(m.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href"));this.onlineResources=g;var g=this._getElement(d,"Contents"),m=[],e;for(d=0;d<g.childNodes.length;d++)e=g.childNodes[d],c(e,"coveragesummary")&&f(a(e),m);this.coverages=
m;m=[];g=this._getElements(g,"SupportedFormat");for(d=0;d<g.length;d++)m.push(this._getElementValue(g[d]));this.supportedFormats=m;return!0},_parse201:function(c){var a;a=this._getElement(c,"ServiceIdentification");this.name=this._getElementValue(a,"Title");this.supportedVersions=this._getElementValues(a,"ServiceTypeVersion");var f=this._getElements(a,"Profile"),d=[];for(a=0;a<f.length;a++)d.push(this._getElementValue(f[a]));this.profiles=d;a={};f=this._getElement(c,"OperationsMetadata");a.getCapabilities=
this._removeTrailingQuestionMark(this._getElement(f.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href"));a.describeCoverage=this._removeTrailingQuestionMark(this._getElement(f.querySelector("Operation[name\x3dDescribeCoverage]"),"Get").getAttribute("xlink:href"));a.getCoverage=this._removeTrailingQuestionMark(this._getElement(f.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href"));this.onlineResources=a;var f=this._getElements(c,"Contents/CoverageSummary"),
d=[],g,e,k;for(a=0;a<f.length;a++){g=f[a];e={};e.id=this._getElementValue(g,"CoverageId");if(k=this._getElement(g,"WGS84BoundingBox"))g=this._getElementValue(k,"LowerCorner").split(" "),k=this._getElementValue(k,"UpperCorner").split(" "),e.lonLatEnvelope=new b({xmin:parseFloat(g[0]),ymin:parseFloat(g[1]),xmax:parseFloat(k[0]),ymax:parseFloat(k[1]),spatialReference:{wkid:4326}});d.push(e)}this.coverages=d;c=this._getElement(c,"ServiceMetadata");f=this._getElements(c,"formatSupported");d=[];for(a=0;a<
f.length;a++)d.push(this._getElementValue(f[a]));this.supportedFormats=d;c=this._getElements(c,"interpolationSupported");f=[];for(a=0;a<c.length;a++)f.push(this._getElementValue(c[a]));this.supportedInterpolations=f.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("cubic")&&(b=2);return b}).filter(function(a){return null!==a});return!0}});u("extend-esri")&&n.setObject("layers.WCSCapabilities",x,d);return x})},
"esri/layers/WCSCoverageDescription":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./TimeInfo ../geometry/Extent".split(" "),function(x,n,u,d,b,c){var g=function(a,b){var c;for(c=0;c<a.length;c++)if(b(a[c]))return c;return-1};x=x(null,{declaredClass:"esri.layers.WCSCoverageDescription",version:null,id:null,description:null,lonLatEnvelope:null,extent:null,supportedFormats:null,supportedInterpolations:null,bandInfo:null,timeInfo:null,multidimensionalInfo:null,resolution:null,
columns:null,rows:null,nativeCoverageDescription:null,_useEPSGAxis:!1,_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,
21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],constructor:function(a,b){this.version=b;this._parse=n.hitch(this,this._parse);a&&n.mixin(this,this._parse(a,b))},_parse:function(a,b){var c;this.version=b;switch(b){case "1.0.0":a=this._parse100(a);this._useEPSGAxis=!1;this.id=a.name;this.description=a.description||
a.label;this.lonLatEnvelope=a.lonLatEnvelope;this.extent=a.domainSet.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domainSet;c=a.rangeSet;a.supportedInterpolations&&0<a.supportedInterpolations.length&&(this.supportedInterpolations=a.supportedInterpolations.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("cubic")&&(b=2);return b}).filter(function(a){return null!==a}));break;case "1.1.0":case "1.1.1":case "1.1.2":a=
this._parse110(a);this.id=a.identifier;this.description=a["abstract"]||a.title;this.extent=a.domain.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domain;c=a.range;a.range[0].supportedInterpolations&&0<a.range[0].supportedInterpolations.length&&(this.supportedInterpolations=a.range[0].supportedInterpolations.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("bicubic")&&(b=2);return b}).filter(function(a){return null!==
a}));break;case "2.0.1":a=this._parse201(a);this._useEPSGAxis=!0;this.id=a.coverageId;this.description=a.description||a.coverageId;this.extent=a.boundedBy.envelope;this.supportedFormats=a.serviceParameters.supportedFormats;b=a.domainSet;c=a.rangeType;break;default:throw"unsupported WCS version "+b;}this.nativeCoverageDescription=a;this.resolution=a.resolution;this.columns=b.columns||b.spatialDomain.columns;this.rows=b.rows||b.spatialDomain.rows;this.bandInfo=this._getBandInfo(c);this.timeInfo=this._getTimeInfo(a);
this.multidimensionalInfo=this._getMultidimensionalInfo(a)},_getElements:function(a,b){if(!a)return null;if(!b)return a;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";return b?this._getElement(a,c).getElementsByTagNameNS("*",b):a.getElementsByTagNameNS("*",c)},_getElement:function(a,b){if(!a)return null;if(!b)return a;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";a=this._getElements(a,c);return 0<a.length?b?this._getElement(a[0],
b):a[0]:null},_getElementValue:function(a,b){return(a=this._getElement(a,b))?(a=a.textContent||a.text||a.nodeValue||a.innerText)?a.trim():null:null},_getElementValues:function(a,b){a=this._getElements(a,b);b=[];var c,f;for(f=0;f<a.length;f++)if(c=a[f].textContent||a[f].text||a[f].nodeValue||a[f].innerText)c=c.trim(),""!==c&&b.push(c);return b},_checkTagName:function(a,b){if(null===a||null===b||null===a.tagName||void 0===a.tagName)return!1;a=a.tagName.toLowerCase();b=b.toLowerCase();return a===b||
0<a.indexOf(":"+b)},_parseTimeResolution:function(a){if(!a)return{resolution:null,units:null};var b=a.toUpperCase(),c=["Y","M","D"],d=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");var e;-1===b.indexOf("PT")?(b=b.slice(1),c=g(c,function(a){return-1<b.indexOf(a)}),-1<c&&(e=a[c])):(b=b.slice(2),c=g(d,function(a){return-1<b.indexOf(a)}),e=a[3+c]);return{resolution:parseFloat(b.substring(0,b.length-1)),units:e}},_getMultidimensionalInfo:function(a){var b,c,d=this.version,e=[];if(0===
d.indexOf("1.1"))(c=a.range.filter(function(a){return-1===a.identifier.toLowerCase().indexOf("field_1")&&!a.axis.some(function(a){return"band"===a.identifier.toLowerCase()})}))&&0<c.length&&(c.forEach(function(a){var b=a.axis.map(function(a){a={name:a.identifier.trim(),field:a.identifier.trim(),unit:a.valuesUnit?a.valuesUnit.trim():"",hasRegularIntervals:!1,values:a.values.map(function(a){return parseFloat(a.trim())})};a.extent=[Math.min.apply(null,a.values),Math.max.apply(null,a.values)];return a});
e.push({name:a.identifier.trim(),description:a.description?a.description.trim():"",unit:"",dimensions:b})}),0<e.length&&(b={variables:e}));else if(0===d.indexOf("2.0")&&(c=[],a.rangeType.forEach(function(a){c=c.concat(a.filter(function(a){return-1===a.name.toLowerCase().indexOf("band")}))}),c&&0<c.length)){var g=[],d=function(a){var b,c="";Math.abs(a-1/24)<1/24*.01?(b=1,c="Hours"):.01>Math.abs(a-1)?(b=1,c="Days"):1>a?(b=Math.round(24*a),c="Hours"):27.99<a&&31.01>a?(b=1,c="Months"):12>Math.round(a/
30)?(b=12>Math.round(a/30),c="Months"):364.99<a&&366.01>a&&(b=1,c="Years");return{interval:b,intervalUnit:c}},q=a.boundedBy,l,p,C,r;for(l=2;l<a.domainSet.axisLabels.length;l++)p=(q.uomLabels&&q.uomLabels.length)>l?q.uomLabels[l]:"",p=(C=-1<a.domainSet.axisLabels[l].toLowerCase().indexOf("time")||"iso8601"===p.toLowerCase())?d(a.domainSet.offset[l]):{interval:a.domainSet.offset[l],intervalUnit:p},r={name:a.domainSet.axisLabels[l].trim(),field:a.domainSet.axisLabels[l].trim(),unit:q.uomLabels&&q.uomLabels.length>
l?q.uomLabels[l].trim():"",hasRegularIntervals:!0},n.mixin(r,p),r.extent=C?[(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.mins[l]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[l]-25569))]:[q.envelopeAllDims.mins[l],q.envelopeAllDims.maxs[l]],g.push(r);c.forEach(function(a){e.push({name:a.name.trim(),description:a.description.trim(),unit:a.uom.trim(),dimensions:g})});0<e.length&&(b={variables:e})}return b},_getBandInfo:function(a){var b,c,d=!1,e;switch(this.version){case "1.0.0":for(b=
0;b<a.length&&!d;b++)for(c=0;c<a[b].axis.length;c++)if("band"===a[b].axis[c].name.toLowerCase()){e=a[b].axis[c].values;d=!0;break}break;case "1.1.0":case "1.1.1":case "1.1.2":for(b=0;b<a.length&&!d;b++)for(c=0;c<a[b].axis.length;c++)if("band"===a[b].axis[c].identifier.toLowerCase()){e=a[b].axis[c].values;d=!0;break}break;case "2.0.1":for(b=0;b<a[0].length;b++)-1<a[0][b].name.toLowerCase().indexOf("band")&&(e=e||[],e.push(a[0][b].name))}return e},_useLatLong:function(a){var b,c;for(c=0;c<this._REVERSED_LAT_LONG_RANGES.length;c++){var d=
this._REVERSED_LAT_LONG_RANGES[c];if(a>=d[0]&&a<=d[1]){b=!0;break}}return b},_getTimeInfo:function(a){var c,d;switch(this.version){case "1.0.0":case "1.1.0":case "1.1.1":case "1.1.2":(a=(a.domainSet||a.domain).temporalDomain)&&(c=new b({timeExtent:[a.begin,a.end],interval:a.resolution,intervalUnit:a.unit}));break;case "2.0.1":d=g(a.domainSet.axisLabels,function(a){return-1<a.toLowerCase().indexOf("time")}),-1<d&&(c=new b({startTimeField:a.domainSet.axisLabels[d],timeExtent:[(new Date).setTime(864E5*
(a.boundedBy.envelopeAllDims.mins[d]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[d]-25569))]}))}return c},_parse100:function(a){var b={name:null,label:null,lonLatEnvelope:null,supportedFormats:null,supportedCRSs:null,domainSet:null,rangeSet:null,description:null,metadataLink:null,supportedInterpolations:null},d=a.childNodes.length,g=this._checkTagName,e=n.hitch(this,function(a){var b=this._getElementValues(a,"requestResponseCRSs").map(function(a){return a.split(":")[1]});a=
this._getElementValues(a,"nativeCRSs").map(function(a){return a.split(":")[1]});return{requestResponseCRSs:b,nativeCRSs:a}}),k=n.hitch(this,function(a){var b=this._getElementValues(a,"interpolationMethod"),c=a.getAttribute("default");return void 0!==c||null!==c?[c].concat(b.filter(function(a){return a.toLowerCase()!==c.toLowerCase()})):b}),q=n.hitch(this,function(a){var b=this._getElements(a,"pos");a=this._getElementValue(b[0]).split(" ");b=this._getElementValue(b[1]).split(" ");return new c({xmin:parseFloat(a[0]),
ymin:parseFloat(a[1]),xmax:parseFloat(b[0]),ymax:parseFloat(b[1]),spatialReference:{wkid:4326}})}),l=n.hitch(this,function(a){var b=[];a=this._getElements(a,"RangeSet");var c,d,e,f,g,h,k,B;for(k=0;k<a.length;k++){c={};c.name=this._getElementValue(a[k],"name");c.label=this._getElementValue(a[k],"label");c.axis=[];d=this._getElements(a[k],"AxisDescription");for(B=0;B<d.length;B++){e={};e.name=this._getElementValue(d[B],"name");e.label=this._getElementValue(d[B],"label");f=[];f=this._getElementValues(d[B],
"singleValue");if(0===f.length&&(g=this._getElementValue(d[B],"min"),h=this._getElementValue(d[B],"max"),null!==g&&null!==h))for(g=parseInt(g,10);g<=parseInt(h,10);g++)f.push(g);e.values=f;c.axis.push(e)}b.push(c)}return b}),p=n.hitch(this,function(a){var b={},d={},e=this._getElement(a,"spatialDomain"),f=this._getElement(e,"Envelope")||this._getElement(e,"EnvelopeWithTimePeriod"),g=f.getAttribute("srsName").split(":"),g=g[g.length-1],h=this._getElements(f,"pos"),f=this._getElementValue(h[0]).split(" "),
h=this._getElementValue(h[1]).split(" ");d.envelope=new c({xmin:parseFloat(f[0]),ymin:parseFloat(f[1]),xmax:parseFloat(h[0]),ymax:parseFloat(h[1]),spatialReference:{wkid:parseInt(g,10)}});var g=this._getElement(e,"RectifiedGrid"),f=this._getElementValue(g,"low").split(" "),h=this._getElementValue(g,"high").split(" "),g=parseInt(h[0],10)-parseInt(f[0],10)+1,f=parseInt(h[1],10)-parseInt(f[1],10)+1,h=this._getElementValue(e,"origin/pos").split(" "),k=this._getElements(e,"offsetVector"),e=parseFloat(this._getElementValue(k[0]).split(" ")[0]),
k=parseFloat(this._getElementValue(k[0]).split(" ")[1]);d.columns=g;d.rows=f;d.offset={x:e,y:k};d.origin={x:parseFloat(h[0]),y:parseFloat(h[1])};b.spatialDomain=d;d={begin:null,end:null};e=[];if(g=this._getElement(a,"temporalDomain")){a=this._getElements(g,"timeposition");if(0<a.length){for(g=0;g<a.length;g++)e.push(new Date(this._getElementValue(a[g])));d.begin=e[0];d.end=e[e.length-1];d.values=e}else if(a=this._getElement(g,"timePeriod"))d.begin=new Date(this._getElementValue(a,"beginPosition")),
d.end=new Date(this._getElementValue(a,"endPosition")),a=this._getElementValue(a,"timeResolution"),d=n.mixin(d,this._parseTimeResolution(a));b.temporalDomain=d}return b}),C,r;for(C=0;C<d;C++)r=a.childNodes[C],g(r,"description")?b.description=this._getElementValue(r):g(r,"name")?b.name=this._getElementValue(r):g(r,"label")?b.label=this._getElementValue(r):g(r,"supportedFormats")?b.supportedFormats=this._getElementValues(r,"formats"):g(r,"supportedCRSs")?b.supportedCRSs=e(r):g(r,"supportedInterpolations")?
b.supportedInterpolations=k(r):g(r,"lonLatEnvelope")?b.lonLatEnvelope=q(r):g(r,"rangeSet")?b.rangeSet=l(r):g(r,"domainSet")&&(b.domainSet=p(r),b.resolution=b.domainSet.spatialDomain.offset);return b},_parse110:function(a){var b={title:null,"abstract":null,identifier:null,supportedFormats:null,supportedCRSs:null,domain:null,range:null,metadata:null},d=a.childNodes.length,g=this._checkTagName,e=n.hitch(this,function(a){var b=[];a=this._getElements(a,"Field");var c,d,e,g,f;for(c=0;c<a.length;c++){e=
{};e.identifier=this._getElementValue(a[c],"Identifier");e.description=this._getElementValue(a[c],"Description");e.definition=this._getElementValue(a[c],"Definition");e.Abstract=this._getElementValue(a[c],"Abstract");e.Title=this._getElementValue(a[c],"Title");e.supportedInterpolations=this._getElementValues(a[c],"InterpolationMethod");e.axis=[];f=this._getElements(a[c],"Axis");for(d=0;d<f.length;d++)g={},g.identifier=f[d].getAttribute("identifier"),g.valuesUnit=this._getElementValue(f[d],"valuesUnit"),
g.dataType=this._getElementValue(f[d],"DataType"),g.values=this._getElementValues(f[d],"Key"),e.axis.push(g);b.push(e)}return b}),k=n.hitch(this,function(a){for(var b={},d={},e=this._getElement(a,"SpatialDomain"),g=this._getElement(e,"GridCRS"),f=this._getElementValue(g,"GridBaseCRS"),h=this._getElementValue(g,"GridOrigin"),h=h?h.split(" "):[0,0],g=this._getElementValue(g,"GridOffsets").split(" "),w=this._getElements(e,"BoundingBox"),k,l,m,p,B,e=0;e<w.length;e++)"urn:ogc:def:crs:OGC::imageCRS"===
w[e].getAttribute("crs")?(m=this._getElementValue(w[e],"LowerCorner").split(" "),p=this._getElementValue(w[e],"UpperCorner").split(" "),k=parseInt(p[0],10)-parseInt(m[0],10)+1,l=parseInt(p[1],10)-parseInt(m[1],10)+1):0<w[e].getAttribute("crs").indexOf("EPSG")&&(B=w[e].getAttribute("crs").split("::")[1],m=this._getElementValue(w[e],"LowerCorner").split(" "),p=this._getElementValue(w[e],"UpperCorner").split(" "),d.envelope=new c({xmin:parseFloat(m[0]),ymin:parseFloat(m[1]),xmax:parseFloat(p[0]),ymax:parseFloat(p[1]),
spatialReference:{wkid:parseInt(B,10)}}));e=k>l;w=d.envelope.xmax-d.envelope.xmin>d.envelope.ymax-d.envelope.ymin;this._useLatLong(B)&&(e===w?this._useEPSGAxis=!1:(this._useEPSGAxis=!0,d.envelope=new c({xmin:d.envelope.ymin,ymin:d.envelope.xmin,xmax:d.envelope.ymax,ymax:d.envelope.xmax,spatialReference:{wkid:parseInt(B,10)}})));d.columns=k;d.rows=l;d.origin={x:parseFloat(h[0]),y:parseFloat(h[1])};d.offset={x:parseFloat(g[0]),y:parseFloat(g[1])};d.gridBaseCRS=f;b.spatialDomain=d;d={begin:null,end:null};
f=[];if(h=this._getElement(a,"temporalDomain")){a=this._getElements(h,"timeposition");if(0<a.length){for(e=0;e<a.length;e++)f.push(new Date(this._getElementValue(a[e])));d.begin=f[0];d.end=f[f.length-1];d.values=f}else a=this._getElements(h,"timePeriod"),0<a.length&&(d.begin=new Date(this._getElementValue(a[0],"beginPosition")),d.end=new Date(this._getElementValue(a[0],"endPosition")),a=this._getElementValue(a[0],"timeResolution"),d=n.mixin(d,this._parseTimeResolution(a)));b.temporalDomain=d}return b}),
q,l;for(q=0;q<d;q++)l=a.childNodes[q],g(l,"Title")?b.title=this._getElementValue(l):g(l,"Abstract")?b["abstract"]=this._getElementValue(l):g(l,"Identifier")?b.identifier=this._getElementValue(l):g(l,"SupportedFormat")?(b.supportedFormats||(b.supportedFormats=[]),b.supportedFormats.push(this._getElementValue(l))):g(l,"SupportedCRS")?(b.supportedCRSs||(b.supportedCRSs=[]),b.supportedCRSs.push(this._getElementValue(l))):g(l,"Range")?b.range=e(l):g(l,"Domain")&&(b.domain=k(l),b.resolution=b.domain.spatialDomain.offset);
return b},_parse201:function(a){var b={coverageId:null,boundedBy:null,domainSet:null,rangeType:null,serviceParameters:null,coverageFunction:null,extension:null},d=a.childNodes.length,g=function(a){return parseFloat(a)},e=function(a){return parseInt(a,10)},k=this._checkTagName,q=n.hitch(this,function(a){var b={envelope:null,axisLabels:null,uomLabels:null,envelopeAllDims:null};a=this._getElement(a,"Envelope");var d=a.getAttribute("srsName"),d=d.slice(d.lastIndexOf("/")+1),e=a.getAttribute("axisLabels"),
f=this._getElementValue(a,"lowerCorner").split(" ").map(g),h=this._getElementValue(a,"upperCorner").split(" ").map(g);"y lat latitude north nor n b".split(" ").some(function(a){return a===e[0].toLowerCase()})?b.envelope=new c({xmin:f[1],ymin:f[0],xmax:h[1],ymax:h[0],spatialReference:{wkid:parseInt(d,10)}}):b.envelope=new c({xmin:f[0],ymin:f[1],xmax:h[0],ymax:h[1],spatialReference:{wkid:parseInt(d,10)}});b.axisLabels=e;b.envelopeAllDims={mins:f,maxs:h};a=a.getAttribute("uomLabels").trim().split(" ");
b.uomLabels=a.length?a:null;return b}),l=n.hitch(this,function(a){var b=[];a=this._getElements(a,"DataRecord");var c,d,e,g,f,h,k=function(a){return a.map(function(a){return parseFloat(a)})};for(g=0;g<a.length;g++){c=this._getElements(a[g],"field");d=[];for(f=0;f<c.length;f++){e={};e.name=c[f].getAttribute("name");e.description=this._getElementValue(c[f],"description")||"";e.uom=this._getElement(c[f],"uom").getAttribute("code")||"";if(h=this._getElementValue(c[f],"interval"))h=h.split(" "),e.allowedValues=
k(h);d.push(e)}b.push(d)}return b}),p=n.hitch(this,function(a){var b={},c=this._getElement(a,"RectifiedGrid"),d=this._getElementValue(c,"low").split(" ").map(e),f=this._getElementValue(c,"high").split(" ").map(e);a=[];var h;for(h=0;h<d.length;h++)a.push(f[h]-d[h]+1);var k=this._getElementValue(c,"axisLabels").split(" "),d=this._getElementValue(c,"origin/pos").split(" ").map(g),c=this._getElements(c,"offsetVector"),f=[];for(h=0;h<c.length;h++)f.push(parseFloat(this._getElementValue(c[h]).split(" ")[h]));
"y lat latitude north nor n b".split(" ").some(function(a){return a===k[0].toLowerCase()})?(b.columns=a[1],b.rows=a[0],b._resolution={y:f[0],x:f[1]}):(b.columns=a[0],b.rows=a[1],b._resolution={x:f[0],y:f[1]});b.gridSamples=a;b.axisLabels=k;b.offset=f;b.origin=d;return b}),C,r;for(C=0;C<d;C++)r=a.childNodes[C],k(r,"coverageId")?b.coverageId=this._getElementValue(r):k(r,"ServiceParameters")?b.serviceParameters={supportedFormats:this._getElementValues(r,"nativeFormat")}:k(r,"boundedBy")?b.boundedBy=
q(r):k(r,"rangeType")?b.rangeType=l(r):k(r,"domainSet")&&(b.domainSet=p(r),b.resolution=b.domainSet._resolution);return b}});u("extend-esri")&&n.setObject("layers.WCSCoverageDescription",x,d);return x})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(x,n,u,d,b,c,g,a,f,h,m,e,k,q,l,p,C){var r,t,y,v,I,w;n=n(h,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(c,e,g){var f=this,w=new d(q._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";
if(!c.imageServiceParameters)throw"Insufficient parameters to read data";var h=u.clone(c.imageServiceParameters),k=c.pixelType;b.some(this.validPixelTypes,function(a){return a===k})||(h.pixelType="F32");b.some(this.validFormats,function(a){return a.toLowerCase()===h.format.toLowerCase()})||(h.format="lerc");var B=c.decodeFunc,l;this._prepareGetImageParameters(h);var p=h.width,F=h.height,z=h.extent;delete h.width;delete h.height;delete h.extent;w._pendingDfd=m({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:u.mixin(h,{f:"image"}),load:function(a){f.decode(a,{width:p,height:F,planes:null,pixelType:k,noDataValue:h.noData,format:h.format,decodeFunc:B}).then(function(a){l={pixelBlock:a,extent:z};f._resolve([l,h],"onRasterReadComplete",e,w)},function(a){f._resolve([a],null,g,w,!0)})},error:function(a){f._resolve([a],null,g,w,!0)}});return w.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,d;b.format&&(c=b.format.toUpperCase());"BSQ"!==
c&&"BIP"!==c&&(c=this._getFormat(a));d=b.decodeFunc;if(void 0===d||null===d)d=this._getFormatDecoderDfd(c);return d(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new e(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new k(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==
a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,c=b.spatialReference.wkid||g.toJson(b.spatialReference.toJson());delete a._ts;u.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:a.xmax=a.xmin+d*c/b;return a},
_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&q._resDfd(d,a,e)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=u.hitch(this,b);return function(c,
e){var g=new d;try{var f;"LERC"===a||!0===I?(f=b(c,e),g.resolve(f)):w.then(function(){f=b(c,e);g.resolve(f)})}catch(M){g.reject(M)}return g}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!r)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);a=(new r).decode(a);
if(!E(a,b))throw"The decoded image dimensions are incorrect.";b=[];var c,d;for(c=0;c<a.pixels.length;c++)d=a.pixels[c],b.push(this._calculateBandStatistics(d));return new l({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:b})},_decodePng:function(a,b){if(!t)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);a=new Uint8Array(a);var c=new t(a);a=new Uint8Array(b.width*b.height*4);c.copyToImageData(a,c.decodePixels());for(var d=c=0,e,d=new Uint8Array(b.width*
b.height),c=0;c<b.width*b.height;c++)d[c]=a[4*c+3];for(var g=new l({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:d,statistics:[]}),c=0;3>c;c++){e=new Uint8Array(b.width*b.height);for(d=0;d<b.width*b.height;d++)e[d]=a[4*d+c];g.addData({pixels:e,statistics:this._calculateBandStatistics(e)})}return g},_decodeBsq:function(a,b){if(!y)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);a=y.decodeBSQ(a,{bandCount:b.planes,width:b.width,
height:b.height,pixelType:A,noDataValue:z});var c=[],d,e=null;for(d=0;d<a.pixels.length;d++)e=a.pixels[d],c.push(this._calculateBandStatistics(e));return new l({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.maskData,statistics:c})},_decodeBip:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);a=y.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:A,noDataValue:z});var c=[],d,e=null;for(d=0;d<a.pixels.length;d++)e=
a.pixels[d],c.push(this._calculateBandStatistics(e));return new l({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.maskData,statistics:c})},_decodeTiff:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);a=v.decode(a);b=[];var c,d=null;for(c=0;c<a.pixels.length;c++)d=a.pixels[c],b.push(this._calculateBandStatistics(d,a.maskData));return new l({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:b})},
_decodeLerc:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);for(var c=0,d,e=0,g,f=a.byteLength-10;e<f;){var w=p.decode(a,{inputOffset:e,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:A,noDataValue:z}),e=w.fileInfo.eofOffset;0===c&&(d=w.encodedMaskData,g=new l({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:w.maskData,statistics:[]}));c++;if(!E(w,b))throw"The decoded image dimensions are incorrect";
g.addData({pixels:w.pixelData,statistics:{minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue}})}return g},_decodeLerc2:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);for(var c=0,d,e,g=0,f,w=a.byteLength-10,h=[];g<w;){e=C.decode(a,{inputOffset:g,maskData:d,returnFileInfo:!0});g=e.fileInfo.eofOffset;0===c&&(d=e.maskData,f=new l({width:b.width,height:b.height,pixels:[],pixelType:e.fileInfo.pixelType,mask:e.maskData,statistics:[]}));e.fileInfo.mask&&
0<e.fileInfo.mask.numBytes&&h.push(e.maskData);c++;if(!E(e,b))throw"The decoded image dimensions are incorrect";f.addData({pixels:e.pixelData,statistics:{minValue:e.minValue,maxValue:e.maxValue,noDataValue:e.noDataValue}})}if(1<h.length){e=f.width*f.height;f.bandMasks=h;d=new Uint8Array(e);d.set(h[0]);for(b=1;b<h.length;b++)for(a=h[b],c=0;c<e;c++)d[c]&=a[c];f.maskData=d}return f},_calculateBandStatistics:function(a,b){var c=Infinity,d=-Infinity,e=a.length,g,f=0;if(b)for(g=0;g<e;g++)b[g]&&(f=a[g],
c=f<c?f:c,d=f>d?f:d);else for(g=0;g<e;g++)f=a[g],c=f<c?f:c,d=f>d?f:d;return{minValue:c,maxValue:d}},_loadRasterFormatModules:function(){I||(w||(w=new d),10>a("ie")?w.isRejected()||w.reject("unsupported browser version"):x(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,c,d){r=a;t=b;y=c;v=d;I=!0;w.isResolved()||w.resolve(!0)}))}});var A=null,z=null,D=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return z=
Math.pow(2,8)-1,A=Uint8Array,"U8";"U16"===a?(z=z||Math.pow(2,16)-1,A=Uint16Array):"U32"===a?(z=z||Math.pow(2,32)-1,A=Uint32Array):"S8"===a?(z=z||0-Math.pow(2,7),A=Int8Array):"S16"===a?(z=z||0-Math.pow(2,15),A=Int16Array):"S32"===a?(z=z||0-Math.pow(2,31),A=Int32Array):A=Float32Array;return a},E=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};a("extend-esri")&&u.setObject("layers.Raster",n,f);return n})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(x,n,u,d){x=x([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(b){if(b){if(!b.width||Math.floor(b.width)!==b.width)throw"PixelBlock: incorrect width";if(!b.height||Math.floor(b.height)!==b.height)throw"PixelBlock: incorrect height";if(!b.pixels)throw"PixelBlock: pixel data not present";this.width=b.width;this.height=b.height;this.pixels=b.pixels;
this.pixelType=b.pixelType||null;this.statistics=b.statistics;this.mask=b.mask||null;this.maskIsAlpha=b.maskIsAlpha||!1;b=b.validPixelCount;null==b&&(b=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=b}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(b){if(!b.pixels||!b.statistics)throw"Pixel data or statistics are not present";if(b.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(b.statistics);this.pixels.push(b.pixels)},getAsRGBA:function(){var b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(b);break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)},getAsRGBAFloat:function(){var b=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b},clone:function(b){b=
b||this;var c=new this.constructor;c.width=b.width;c.height=b.height;c.pixelType=b.pixelType;c.maskIsAlpha=b.maskIsAlpha;b.mask&&(c.mask=new Uint8Array(b.mask));var d,a,f;if(b.pixels)for(c.pixels=[],f=(a=b.pixels.length)&&b.pixels[0].slice,d=0;d<a;d++)c.pixels[d]=f?b.pixels[d].slice(0,b.pixels[d].length):new b.pixels[d].constructor(b.pixels[d]);if(b.statistics)for(c.statistics=[],a=b.statistics.length,d=0;d<a;d++)c.statistics[d]=n.clone(b.statistics[d]);b=b.validPixelCount;null==b&&(b=c.mask?this._getValidPixelCount(c.mask):
c.width*c.height);return c},clamp:function(b){if("F64"!==b&&"F32"!==b){var c;switch(b){case "U8":c=[0,255];break;case "U16":c=[0,65535];break;case "U32":c=[0,4294967295];break;case "S8":c=[-128,127];break;case "S16":c=[-32768,32767];break;case "S32":c=[-2147483648,2147483647];break;default:c=[-3.4*1E39,3.4*1E39]}var d=c[0];c=c[1];var a=this.pixels,f=this.width*this.height,h=a.length,m,e,k,q,l,p=[];for(q=0;q<h;q++){k=this._createEmptyBand(b,f);m=a[q];for(l=0;l<f;l++)e=m[l],k[l]=e>c?c:e<d?d:e;p.push(k)}this.pixels=
p;this.pixelType=b}},calculateStatistics:function(){var b,c=[],d,a=this.mask;for(b=0;b<this.pixels.length;b++)d=this.pixels[b],c.push(this._calculateBandStatistics(d,a));this.statistics=c},_getValidPixelCount:function(b){var c,d=0;for(c=0;c<b.length;c++)b[c]&&d++;return d},_createEmptyBand:function(b,c){switch(b){case "U8":b=new Uint8Array(c);break;case "U16":b=new Uint16Array(c);break;case "U32":b=new Uint32Array(c);break;case "S8":b=new Int8Array(c);break;case "S16":b=new Int16Array(c);break;case "S32":b=
new Int32Array(c);break;case "U32":b=new Uint32Array(c);break;case "F32":b=new Float32Array(c);break;case "F64":b=new Float64Array(c);break;default:b=new Float32Array(c)}return b},_fillFrom8Bit:function(b){var c=this.pixels,d=this.mask;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,f,h;a=f=h=c[0];3<=c.length&&(f=c[1],h=c[2]);var c=new Uint32Array(b),m=this.width*this.height;if(a.length!==m)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(d&&d.length===m)if(this.maskIsAlpha)for(b=0;b<m;b++)d[b]&&(c[b]=d[b]<<24|h[b]<<16|f[b]<<8|a[b]);else for(b=0;b<m;b++)d[b]&&(c[b]=-16777216|h[b]<<16|f[b]<<8|a[b]);else for(b=0;b<m;b++)c[b]=-16777216|h[b]<<16|f[b]<<8|a[b]},_fillFromNon8Bit:function(b){var c=this.pixels,d=this.mask,a=this.statistics;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var f=1,h=0,f=1;a&&0<a.length?(h=a.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,
b)}),f=a.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),f=255/f):(f=255,"S8"===this.pixelType?(h=-128,f=127):"U16"===this.pixelType?f=65535:"S16"===this.pixelType?(h=-32768,f=32767):"U32"===this.pixelType?f=4294967295:"S32"===this.pixelType?(h=-2147483648,f=2147483647):"F32"===this.pixelType?(h=-3.4*1E39,f=3.4*1E39):"F64"===this.pixelType&&(h=-Number.MAX_VALUE,f=Number.MAX_VALUE),f=255/(f-h));b=new Uint32Array(b);var a=this.width*this.height,m,e,k;m=c[0];
if(m.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=c.length)if(e=c[1],k=c[2],d&&d.length===a)for(c=0;c<a;c++)d[c]&&(b[c]=-16777216|(k[c]-h)*f<<16|(e[c]-h)*f<<8|(m[c]-h)*f);else for(c=0;c<a;c++)b[c]=-16777216|(k[c]-h)*f<<16|(e[c]-h)*f<<8|(m[c]-h)*f;else if(d&&d.length===a)for(c=0;c<a;c++)e=(m[c]-h)*f,d[c]&&(b[c]=-16777216|e<<16|e<<8|e);else for(c=0;c<a;c++)e=(m[c]-h)*f,b[c]=-16777216|e<<16|e<<8|e},_fillFrom32Bit:function(b){var c=this.pixels,d=this.mask;
if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,f,h;a=f=h=c[0];3<=c.length&&(f=c[1],h=c[2]);var m=this.width*this.height;if(a.length!==m)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var e=0;if(d&&d.length===m)for(c=0;c<m;c++)b[e++]=a[c],b[e++]=f[c],b[e++]=h[c],b[e++]=d[c]&1;else for(c=0;c<m;c++)b[e++]=a[c],b[e++]=f[c],b[e++]=h[c],b[e++]=1},_calculateBandStatistics:function(b,c){var d=Infinity,a=-Infinity,
f=b.length,h,m=0;if(c)for(h=0;h<f;h++)c[h]&&(m=b[h],d=m<d?m:d,a=m>a?m:a);else for(h=0;h<f;h++)m=b[h],d=m<d?m:d,a=m>a?m:a;return{minValue:d,maxValue:a}}});u("extend-esri")&&n.setObject("layers.PixelBlock",x,d);return x})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var x={defaultNoDataValue:-3.4027999387901484E38,decode:function(u,d){var b;d=d||{};var c=d.inputOffset||0,g=d.encodedMaskData||null===d.encodedMaskData,a={},f=new Uint8Array(u,c,10);a.fileIdentifierString=String.fromCharCode.apply(null,
f);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;c+=10;f=new DataView(u,c,24);a.fileVersion=f.getInt32(0,!0);a.imageType=f.getInt32(4,!0);a.height=f.getUint32(8,!0);a.width=f.getUint32(12,!0);a.maxZError=f.getFloat64(16,!0);c+=24;if(!g)if(f=new DataView(u,c,16),a.mask={},a.mask.numBlocksY=f.getUint32(0,!0),a.mask.numBlocksX=f.getUint32(4,!0),a.mask.numBytes=f.getUint32(8,!0),a.mask.maxValue=f.getFloat32(12,!0),c+=16,0<a.mask.numBytes){var g=
new Uint8Array(Math.ceil(a.width*a.height/8)),f=new DataView(u,c,a.mask.numBytes),h=f.getInt16(0,!0),m=2,e=0;do{if(0<h)for(;h--;)g[e++]=f.getUint8(m++);else for(var k=f.getUint8(m++),h=-h;h--;)g[e++]=k;h=f.getInt16(m,!0);m+=2}while(m<a.mask.numBytes);if(-32768!==h||e<g.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=g;c+=a.mask.numBytes}else 0===(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(g=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=g);f=new DataView(u,c,
16);a.pixels={};a.pixels.numBlocksY=f.getUint32(0,!0);a.pixels.numBlocksX=f.getUint32(4,!0);a.pixels.numBytes=f.getUint32(8,!0);a.pixels.maxValue=f.getFloat32(12,!0);c+=16;g=a.pixels.numBlocksX;f=a.pixels.numBlocksY;g+=0<a.width%g?1:0;h=f+(0<a.height%f?1:0);a.pixels.blocks=Array(g*h);for(e=m=0;e<h;e++)for(k=0;k<g;k++){var q=0,f=new DataView(u,c,Math.min(10,u.byteLength-c)),l={};a.pixels.blocks[m++]=l;var p=f.getUint8(0);q++;l.encoding=p&63;if(3<l.encoding)throw"Invalid block encoding ("+l.encoding+
")";if(2===l.encoding)c++;else{if(0!==p&&2!==p){p>>=6;l.offsetType=p;if(2===p)l.offset=f.getInt8(1),q++;else if(1===p)l.offset=f.getInt16(1,!0),q+=2;else if(0===p)l.offset=f.getFloat32(1,!0),q+=4;else throw"Invalid block offset type";if(1===l.encoding)if(p=f.getUint8(q),q++,l.bitsPerPixel=p&63,p>>=6,l.numValidPixelsType=p,2===p)l.numValidPixels=f.getUint8(q),q++;else if(1===p)l.numValidPixels=f.getUint16(q,!0),q+=2;else if(0===p)l.numValidPixels=f.getUint32(q,!0),q+=4;else throw"Invalid valid pixel count type";
}c+=q;if(3!=l.encoding)if(0===l.encoding){p=(a.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";f=new ArrayBuffer(4*p);q=new Uint8Array(f);q.set(new Uint8Array(u,c,4*p));f=new Float32Array(f);l.rawData=f;c+=4*p}else 1===l.encoding&&(p=Math.ceil(l.numValidPixels*l.bitsPerPixel/8),f=new ArrayBuffer(4*Math.ceil(p/4)),q=new Uint8Array(f),q.set(new Uint8Array(u,c,p)),l.stuffedData=new Uint32Array(f),c+=p)}}a.eofOffset=c;u=null!=d.noDataValue?d.noDataValue:x.defaultNoDataValue;
var g=d.encodedMaskData,p=d.returnMask,h=0,m=a.pixels.numBlocksX,e=a.pixels.numBlocksY,k=Math.floor(a.width/m),l=Math.floor(a.height/e),q=2*a.maxZError,c=Number.MAX_VALUE,C,g=g||(a.mask?a.mask.bitset:null),r,f=new (d.pixelType||Float32Array)(a.width*a.height);p&&g&&(r=new Uint8Array(a.width*a.height));for(var p=new Float32Array(k*l),t,y,v=0;v<=e;v++){var I=v!==e?l:a.height%e;if(0!==I)for(var w=0;w<=m;w++){var A=w!==m?k:a.width%m;if(0!==A){var z=v*a.width*l+w*k,D=a.width-A,E=a.pixels.blocks[h],B,F;
if(2>E.encoding){if(0===E.encoding)B=E.rawData;else{B=E.stuffedData;F=E.bitsPerPixel;C=E.numValidPixels;t=E.offset;y=q;var P=p,H=a.pixels.maxValue,G=(1<<F)-1,L=0,M=void 0,J=0,N=void 0,O=void 0,Q=Math.ceil((H-t)/y);B[B.length-1]<<=8*(4*B.length-Math.ceil(F*C/8));for(M=0;M<C;M++)0===J&&(O=B[L++],J=32),J>=F?(N=O>>>J-F&G,J-=F):(J=F-J,N=(O&G)<<J&G,O=B[L++],J=32-J,N+=O>>>J),P[M]=N<Q?t+N*y:H;B=p}F=0}else b=2===E.encoding?0:E.offset;var K;if(g)for(y=0;y<I;y++){z&7&&(K=g[z>>3],K<<=z&7);for(t=0;t<A;t++)z&7||
(K=g[z>>3]),K&128?(r&&(r[z]=1),C=2>E.encoding?B[F++]:b,c=c>C?C:c,f[z++]=C):(r&&(r[z]=0),f[z++]=u),K<<=1;z+=D}else if(2>E.encoding)for(y=0;y<I;y++){for(t=0;t<A;t++)C=B[F++],c=c>C?C:c,f[z++]=C;z+=D}else for(c=c>b?b:c,y=0;y<I;y++){for(t=0;t<A;t++)f[z++]=b;z+=D}if(1===E.encoding&&F!==E.numValidPixels)throw"Block and Mask do not match";h++}}}b=r;r={width:a.width,height:a.height,pixelData:f,minValue:c,maxValue:a.pixels.maxValue,noDataValue:u};b&&(r.maskData=b);d.returnEncodedMask&&a.mask&&(r.encodedMaskData=
a.mask.bitset?a.mask.bitset:null);if(d.returnFileInfo&&(r.fileInfo=n(a),d.computeUsedBitDepths)){d=r.fileInfo;b=a.pixels.numBlocksX*a.pixels.numBlocksY;K={};for(B=0;B<b;B++)F=a.pixels.blocks[B],0===F.encoding?K.float32=!0:1===F.encoding?K[F.bitsPerPixel]=!0:K[0]=!0;a=Object.keys(K);d.bitDepths=a}return r}},n=function(n){return{fileIdentifierString:n.fileIdentifierString,fileVersion:n.fileVersion,imageType:n.imageType,height:n.height,width:n.width,maxZError:n.maxZError,eofOffset:n.eofOffset,mask:n.mask?
{numBlocksX:n.mask.numBlocksX,numBlocksY:n.mask.numBlocksY,numBytes:n.mask.numBytes,maxValue:n.mask.maxValue}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,numBytes:n.pixels.numBytes,maxValue:n.pixels.maxValue,noDataValue:this.noDataValue}}};return x})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var x={unstuff:function(d,b,c,g,a,f,h,m){var e=(1<<c)-1,k=0,q,l=0,p,n;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*g/8));if(a)for(q=0;q<g;q++)0===l&&(n=
d[k++],l=32),l>=c?(p=n>>>l-c&e,l-=c):(l=c-l,p=(n&e)<<l&e,n=d[k++],l=32-l,p+=n>>>l),b[q]=a[p];else for(a=Math.ceil((m-f)/h),q=0;q<g;q++)0===l&&(n=d[k++],l=32),l>=c?(p=n>>>l-c&e,l-=c):(l=c-l,p=(n&e)<<l&e,n=d[k++],l=32-l,p+=n>>>l),b[q]=p<a?f+p*h:m},unstuffLUT:function(d,b,c,g,a,f){var h=(1<<b)-1,m=0,e=0,k=0,q=k=0,l,p=[];d[d.length-1]<<=8*(4*d.length-Math.ceil(b*c/8));for(var n=Math.ceil((f-g)/a),e=0;e<c;e++)0===k&&(l=d[m++],k=32),k>=b?(q=l>>>k-b&h,k-=b):(k=b-k,q=(l&h)<<k&h,l=d[m++],k=32-k,q+=l>>>k),
p[e]=q<n?g+q*a:f;p.unshift(g);return p},unstuff2:function(d,b,c,g,a,f,h,m){var e=(1<<c)-1,k=0,q,l=0,p=0,n,r,t;if(a)for(q=0;q<g;q++)0===l&&(r=d[k++],l=32,p=0),l>=c?(n=r>>>p&e,l-=c,p+=c):(t=c-l,n=r>>>p&e,r=d[k++],l=32-t,n|=(r&(1<<t)-1)<<c-t,p=t),b[q]=a[n];else for(a=Math.ceil((m-f)/h),q=0;q<g;q++)0===l&&(r=d[k++],l=32,p=0),l>=c?(n=r>>>p&e,l-=c,p+=c):(t=c-l,n=r>>>p&e,r=d[k++],l=32-t,n|=(r&(1<<t)-1)<<c-t,p=t),b[q]=n<a?f+n*h:m;return b},unstuffLUT2:function(d,b,c,g,a,f){for(var h=(1<<b)-1,m=0,e=0,k=0,
q=0,l=0,p=0,n,r=[],t=Math.ceil((f-g)/a),e=0;e<c;e++)0===q&&(n=d[m++],q=32,p=0),q>=b?(l=n>>>p&h,q-=b,p+=b):(k=b-q,l=n>>>p&h,n=d[m++],q=32-k,l|=(n&(1<<k)-1)<<b-k,p=k),r[e]=l<t?g+l*a:f;r.unshift(g);return r},originalUnstuff:function(d,b,c,g){var a=(1<<c)-1,f=0,h,m=0,e,k;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*g/8));for(h=0;h<g;h++)0===m&&(k=d[f++],m=32),m>=c?(e=k>>>m-c&a,m-=c):(m=c-m,e=(k&a)<<m&a,k=d[f++],m=32-m,e+=k>>>m),b[h]=e;return b},originalUnstuff2:function(d,b,c,g){var a=(1<<c)-1,f=0,h,m=0,
e=0,k,q,l;for(h=0;h<g;h++)0===m&&(q=d[f++],m=32,e=0),m>=c?(k=q>>>e&a,m-=c,e+=c):(l=c-m,k=q>>>e&a,q=d[f++],m=32-l,k|=(q&(1<<l)-1)<<c-l,e=l),b[h]=k;return b}},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var b=65535,c=65535,g=d.length,a=Math.floor(g/2),f=0;a;){var h=359<=a?359:a,a=a-h;do b+=d[f++]<<8,c+=b+=d[f++];while(--h);b=(b&65535)+(b>>>16);c=(c&65535)+(c>>>16)}g&1&&(c+=b+=d[f]<<8);return((c&65535)+(c>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(d,b){var c=
b.ptr,g=new Uint8Array(d,c,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,g);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var c=c+6,g=new DataView(d,c,8),f=g.getInt32(0,!0);a.fileVersion=f;c+=4;3<=f&&(a.checksum=g.getUint32(4,!0),c+=4);g=new DataView(d,c,12);a.height=g.getUint32(0,!0);a.width=g.getUint32(4,!0);c+=8;4<=f?(a.numDims=g.getUint32(8,!0),c+=4):a.numDims=1;g=new DataView(d,c,40);a.numValidPixel=
g.getUint32(0,!0);a.microBlockSize=g.getInt32(4,!0);a.blobSize=g.getInt32(8,!0);a.imageType=g.getInt32(12,!0);a.maxZError=g.getFloat64(16,!0);a.zMin=g.getFloat64(24,!0);a.zMax=g.getFloat64(32,!0);c+=40;b.headerInfo=a;b.ptr=c;if(3<=f&&(d=this.computeChecksumFletcher32(new Uint8Array(d,c-(4<=f?52:48),a.blobSize-14)),d!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(d,b){var c=b.headerInfo,g=this.getDataTypeArray(c.imageType),a=c.numDims*this.getDataTypeSize(c.imageType),f=
this.readSubArray(d,b.ptr,g,a);d=this.readSubArray(d,b.ptr+a,g,a);b.ptr+=2*a;a=!0;for(b=0;b<c.numDims;b++)if(f[b]!==d[b]){a=!1;break}c.minValues=f;c.maxValues=d;return a},readSubArray:function(d,b,c,g){if(c===Uint8Array)d=new Uint8Array(d,b,g);else{var a=new ArrayBuffer(g);(new Uint8Array(a)).set(new Uint8Array(d,b,g));d=new c(a)}return d},readMask:function(d,b){var c=b.ptr,g=b.headerInfo,a=g.width*g.height,f=g.numValidPixel,h=new DataView(d,c,4),g={};g.numBytes=h.getUint32(0,!0);c+=4;if((0===f||
a===f)&&0!==g.numBytes)throw"invalid mask";if(0===f)f=new Uint8Array(Math.ceil(a/8)),g.bitset=f,h=new Uint8Array(a),b.pixels.resultMask=h,c+=g.numBytes;else if(0<g.numBytes){f=new Uint8Array(Math.ceil(a/8));h=new DataView(d,c,g.numBytes);d=h.getInt16(0,!0);var m=2,e=0,k=0;do{if(0<d)for(;d--;)f[e++]=h.getUint8(m++);else for(k=h.getUint8(m++),d=-d;d--;)f[e++]=k;d=h.getInt16(m,!0);m+=2}while(m<g.numBytes);if(-32768!==d||e<f.length)throw"Unexpected end of mask RLE encoding";h=new Uint8Array(a);for(m=
m=d=0;m<a;m++)m&7?(d=f[m>>3],d<<=m&7):d=f[m>>3],d&128&&(h[m]=1);b.pixels.resultMask=h;g.bitset=f;c+=g.numBytes}b.ptr=c;b.mask=g;return!0},readDataOneSweep:function(d,b,c){var g=b.ptr,a=b.headerInfo,f=a.numDims,h=a.width*a.height,a=a.numValidPixel*n.getDataTypeSize(a.imageType)*f,m=b.pixels.resultMask;if(c===Uint8Array)d=new Uint8Array(d,g,a);else{var e=new ArrayBuffer(a);(new Uint8Array(e)).set(new Uint8Array(d,g,a));d=new c(e)}if(d.length===h*f)b.pixels.resultPixels=d;else{b.pixels.resultPixels=
new c(h*f);var k=e=c=0,q=0;if(1<f)for(k=0;k<f;k++)for(q=k*h,e=0;e<h;e++)m[e]&&(b.pixels.resultPixels[q+e]=d[c++]);else for(e=0;e<h;e++)m[e]&&(b.pixels.resultPixels[e]=d[c++])}b.ptr=g+a;return!0},readHuffmanTree:function(d,b){var c=this.HUFFMAN_LUT_BITS_MAX,g=new DataView(d,b.ptr,16);b.ptr+=16;if(2>g.getInt32(0,!0))throw"unsupported Huffman version";var a=g.getInt32(4,!0),f=g.getInt32(8,!0),g=g.getInt32(12,!0);if(f>=g)return!1;var h=new Uint32Array(g-f);n.decodeBits(d,b,h);var m=[],e,k,q;for(e=f;e<
g;e++)k=e-(e<a?0:a),m[k]={first:h[e-f],second:null};e=d.byteLength-b.ptr;h=new ArrayBuffer(4*Math.ceil(e/4));(new Uint8Array(h)).set(new Uint8Array(d,b.ptr,e));d=new Uint32Array(h);b=0;var l,h=0;l=d[0];for(e=f;e<g;e++)k=e-(e<a?0:a),q=m[k].first,0<q&&(m[k].second=l<<b>>>32-q,32-b>=q?(b+=q,32===b&&(b=0,h++,l=d[h])):(b+=q-32,h++,l=d[h],m[k].second|=l>>>32-b));var p=l=0,C=new u;for(e=0;e<m.length;e++)void 0!==m[e]&&(l=Math.max(l,m[e].first));p=l>=c?c:l;30<=l&&console.log("WARning, large NUM LUT BITS IS "+
l);var c=[],r,t;for(e=f;e<g;e++)if(k=e-(e<a?0:a),q=m[k].first,0<q)if(f=[q,k],q<=p)for(k=m[k].second<<p-q,r=1<<p-q,q=0;q<r;q++)c[k|q]=f;else for(k=m[k].second,r=C,--q;0<=q;q--)(t=k>>>q&1)?(r.right||(r.right=new u),r=r.right):(r.left||(r.left=new u),r=r.left),0!==q||r.val||(r.val=f[1]);return{decodeLut:c,numBitsLUTQick:p,numBitsLUT:l,tree:C,stuffedData:d,srcPtr:h,bitPos:b}},readHuffman:function(d,b,c){var g=b.headerInfo,a=g.numDims,f=b.headerInfo.height,h=b.headerInfo.width,m=h*f,e=this.readHuffmanTree(d,
b);d=e.decodeLut;var k=e.tree,q=e.stuffedData,l=e.srcPtr,p=e.bitPos,n=e.numBitsLUTQick,e=e.numBitsLUT,r=0===b.headerInfo.imageType?128:0,t,y,v=b.pixels.resultMask,u,w,A,z,D,E,B=0;0<p&&(l++,p=0);var F=q[l],x=1===b.encodeMode,H=new c(m*a),G=H,L;for(L=0;L<g.numDims;L++){1<a&&(G=new c(H.buffer,m*L,m),B=0);if(b.headerInfo.numValidPixel===h*f)for(A=D=0;A<f;A++)for(z=0;z<h;z++,D++){y=0;t=u=F<<p>>>32-n;32-p<n&&(t=u|=q[l+1]>>>64-p-n);if(d[t])y=d[t][1],p+=d[t][0];else for(t=u=F<<p>>>32-e,32-p<e&&(t=u|=q[l+
1]>>>64-p-e),t=k,E=0;E<e;E++)if(t=(w=u>>>e-E-1&1)?t.right:t.left,!t.left&&!t.right){y=t.val;p=p+E+1;break}32<=p&&(p-=32,l++,F=q[l]);y-=r;x?(y=0<z?y+B:0<A?y+G[D-h]:y+B,y&=255,B=G[D]=y):G[D]=y}else for(A=D=0;A<f;A++)for(z=0;z<h;z++,D++)if(v[D]){y=0;t=u=F<<p>>>32-n;32-p<n&&(t=u|=q[l+1]>>>64-p-n);if(d[t])y=d[t][1],p+=d[t][0];else for(t=u=F<<p>>>32-e,32-p<e&&(t=u|=q[l+1]>>>64-p-e),t=k,E=0;E<e;E++)if(t=(w=u>>>e-E-1&1)?t.right:t.left,!t.left&&!t.right){y=t.val;p=p+E+1;break}32<=p&&(p-=32,l++,F=q[l]);y-=
r;x?(y=0<z&&v[D-1]?y+B:0<A&&v[D-h]?y+G[D-h]:y+B,y&=255,B=G[D]=y):G[D]=y}b.ptr=b.ptr+4*(l+1)+(0<p?4:0)}b.pixels.resultPixels=H},decodeBits:function(d,b,c,g,a){var f=b.headerInfo,h=f.fileVersion,m=0,e=new DataView(d,b.ptr,5),k=e.getUint8(0);m++;var q=k>>6,l=0===q?4:3-q,p=0<(k&32)?!0:!1,q=k&31,k=0;if(1===l)k=e.getUint8(m),m++;else if(2===l)k=e.getUint16(m,!0),m+=2;else if(4===l)k=e.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";var l=2*f.maxZError,n,r;a=1<f.numDims?f.maxValues[a]:f.zMax;
if(p){b.counter.lut++;p=e.getUint8(m);m++;f=Math.ceil((p-1)*q/8);n=Math.ceil(f/4);n=new ArrayBuffer(4*n);r=new Uint8Array(n);b.ptr+=m;r.set(new Uint8Array(d,b.ptr,f));m=new Uint32Array(n);b.ptr+=f;for(e=0;p-1>>>e;)e++;f=Math.ceil(k*e/8);n=Math.ceil(f/4);n=new ArrayBuffer(4*n);r=new Uint8Array(n);r.set(new Uint8Array(d,b.ptr,f));d=new Uint32Array(n);b.ptr+=f;b=3<=h?x.unstuffLUT2(m,q,p-1,g,l,a):x.unstuffLUT(m,q,p-1,g,l,a);3<=h?x.unstuff2(d,c,e,k,b):x.unstuff(d,c,e,k,b)}else b.counter.bitstuffer++,e=
q,b.ptr+=m,0<e&&(f=Math.ceil(k*e/8),n=Math.ceil(f/4),n=new ArrayBuffer(4*n),r=new Uint8Array(n),r.set(new Uint8Array(d,b.ptr,f)),d=new Uint32Array(n),b.ptr+=f,3<=h?null==g?x.originalUnstuff2(d,c,e,k):x.unstuff2(d,c,e,k,!1,g,l,a):null==g?x.originalUnstuff(d,c,e,k):x.unstuff(d,c,e,k,!1,g,l,a))},readTiles:function(d,b,c){var g=b.headerInfo,a=g.width,f=g.height,h=g.microBlockSize,m=g.imageType,e=n.getDataTypeSize(m),k=Math.ceil(a/h),q=Math.ceil(f/h);b.pixels.numBlocksY=q;b.pixels.numBlocksX=k;for(var l=
b.pixels.ptr=0,p=0,C=0,r=0,t=0,y=0,v=0,u=0,w=l=0,A=0,z=0,v=v=l=v=0,D,E=new c(h*h),B=f%h||h,F=a%h||h,g=g.numDims,x,H=b.pixels.resultMask,G=b.pixels.resultPixels,C=0;C<q;C++)for(t=C!==q-1?h:B,r=0;r<k;r++)for(y=r!==k-1?h:F,A=C*a*h+r*h,z=a-y,x=0;x<g;x++){1<g&&(G=new c(b.pixels.resultPixels.buffer,a*f*x*e,a*f));v=d.byteLength-b.ptr;p=new DataView(d,b.ptr,Math.min(10,v));D={};v=0;u=p.getUint8(0);v++;l=u>>6&255;w=u>>2&15;if(w!==(r*h>>3&15))throw"integrity issue";u&=3;if(3<u)throw b.ptr+=v,"Invalid block encoding ("+
u+")";if(2===u)b.counter.constant++,b.ptr+=v;else if(0===u){b.counter.uncompressed++;b.ptr+=v;v=t*y*e;l=d.byteLength-b.ptr;v=v<l?v:l;l=new ArrayBuffer(0===v%e?v:v+e-v%e);p=new Uint8Array(l);p.set(new Uint8Array(d,b.ptr,v));D=new c(l);v=0;if(H)for(l=0;l<t;l++){for(p=0;p<y;p++)H[A]&&(G[A]=D[v++]),A++;A+=z}else for(l=0;l<t;l++){for(p=0;p<y;p++)G[A++]=D[v++];A+=z}b.ptr+=v*e}else if(l=n.getDataTypeUsed(m,l),D=n.getOnePixel(D,v,l,p),v+=n.getDataTypeSize(l),3===u)if(b.ptr+=v,b.counter.constantoffset++,H)for(l=
0;l<t;l++){for(p=0;p<y;p++)H[A]&&(G[A]=D),A++;A+=z}else for(l=0;l<t;l++){for(p=0;p<y;p++)G[A++]=D;A+=z}else if(b.ptr+=v,n.decodeBits(d,b,E,D,x),v=0,H)for(l=0;l<t;l++){for(p=0;p<y;p++)H[A]&&(G[A]=E[v++]),A++;A+=z}else for(l=0;l<t;l++){for(p=0;p<y;p++)G[A++]=E[v++];A+=z}}},formatFileInfo:function(d){return{fileIdentifierString:d.headerInfo.fileIdentifierString,fileVersion:d.headerInfo.fileVersion,imageType:d.headerInfo.imageType,height:d.headerInfo.height,width:d.headerInfo.width,numValidPixel:d.headerInfo.numValidPixel,
microBlockSize:d.headerInfo.microBlockSize,blobSize:d.headerInfo.blobSize,maxZError:d.headerInfo.maxZError,pixelType:n.getPixelType(d.headerInfo.imageType),eofOffset:d.eofOffset,mask:d.mask?{numBytes:d.mask.numBytes}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,maxValue:d.headerInfo.zMax,minValue:d.headerInfo.zMin,noDataValue:d.noDataValue}}},constructConstantSurface:function(d){var b=d.headerInfo.zMax,c=d.headerInfo.numDims,g=d.headerInfo.height*d.headerInfo.width,a=
g*c,f=0,h=0,m=0,e=d.pixels.resultMask;if(e)if(1<c)for(f=0;f<c;f++)for(m=f*g,h=0;h<g;h++)e[h]&&(d.pixels.resultPixels[m+h]=b);else for(h=0;h<g;h++)e[h]&&(d.pixels.resultPixels[h]=b);else if(d.pixels.resultPixels.fill)d.pixels.resultPixels.fill(b);else for(h=0;h<a;h++)d.pixels.resultPixels[h]=b},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;
break;case 7:d=Float64Array;break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d="S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,b){if(null==b)return!1;switch(d){case 0:d=-128<=b&&127>=b;break;case 1:d=0<=b&&255>=b;break;case 2:d=-32768<=b&&32767>=b;break;case 3:d=0<=b&&65536>=b;break;case 4:d=-2147483648<=
b&&2147483647>=b;break;case 5:d=0<=b&&4294967296>=b;break;case 6:d=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:d=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:d=!1}return d},getDataTypeSize:function(d){var b=0;switch(d){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=d}return b},getDataTypeUsed:function(d,b){var c=d;switch(d){case 2:case 4:c=d-b;break;case 3:case 5:c=d-2*b;break;case 6:c=0===b?d:1===b?2:1;break;
case 7:c=0===b?d:d-2*b+1;break;default:c=d}return c},getOnePixel:function(d,b,c,g){d=0;switch(c){case 0:d=g.getInt8(b);break;case 1:d=g.getUint8(b);break;case 2:d=g.getInt16(b,!0);break;case 3:d=g.getUint16(b,!0);break;case 4:d=g.getInt32(b,!0);break;case 5:d=g.getUInt32(b,!0);break;case 6:d=g.getFloat32(b,!0);break;case 7:d=g.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return d}},u=function(d,b,c){this.val=d;this.left=b;this.right=c};return{decode:function(d,
b){b=b||{};var c=b.noDataValue,g=0,a={};a.ptr=b.inputOffset||0;a.pixels={};if(n.readHeaderInfo(d,a)){var g=a.headerInfo,f=g.fileVersion,h=n.getDataTypeArray(g.imageType);n.readMask(d,a);g.numValidPixel===g.width*g.height||a.pixels.resultMask||(a.pixels.resultMask=b.maskData);var m=g.width*g.height;a.pixels.resultPixels=new h(m*g.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==g.numValidPixel)if(g.zMax===g.zMin)n.constructConstantSurface(a);else if(4<=
f&&n.checkMinMaxRanges(d,a))n.constructConstantSurface(a);else{var e=new DataView(d,a.ptr,2),k=e.getUint8(0);a.ptr++;if(k)n.readDataOneSweep(d,a,h);else if(1<f&&1>=g.imageType&&1E-5>Math.abs(g.maxZError-.5)){e=e.getUint8(1);a.ptr++;a.encodeMode=e;if(2<e||4>f&&1<e)throw"Invalid Huffman flag "+e;e?n.readHuffman(d,a,h):n.readTiles(d,a,h)}else n.readTiles(d,a,h)}a.eofOffset=a.ptr;b.inputOffset?(d=a.headerInfo.blobSize+b.inputOffset-a.ptr,1<=Math.abs(d)&&(a.eofOffset=b.inputOffset+a.headerInfo.blobSize)):
(d=a.headerInfo.blobSize-a.ptr,1<=Math.abs(d)&&(a.eofOffset=a.headerInfo.blobSize));d={width:g.width,height:g.height,pixelData:a.pixels.resultPixels,minValue:g.zMin,maxValue:g.zMax,validPixelCount:g.numValidPixel,dimCount:g.numDims,dimStats:{minValues:g.minValues,maxValues:g.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&n.isValidPixelValue(g.imageType,c)){f=a.pixels.resultMask;for(g=0;g<m;g++)f[g]||(d.pixelData[g]=c);d.noDataValue=c}a.noDataValue=c;b.returnFileInfo&&(d.fileInfo=
n.formatFileInfo(a));return d}},getBandCount:function(d){for(var b=0,c=0,g={ptr:0,pixels:{}};c<d.byteLength-58;)n.readHeaderInfo(d,g),c+=g.headerInfo.blobSize,b++,g.ptr=c;return b}}})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(x,n,u,d){var b;return n(null,{constructor:function(b){this.ctx=b.ctx;this._loadRasterFormatModule()},decode:function(b,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";
var a=new u,c,g=new Uint8Array(b);b=this._getFormat(b);if("error"===b)throw"invalid format";"jpeg"===b&&(c=this._getMask(g,d));var m="",e,k;for(e=0;e<g.length;e+=65535)k=g.subarray(e,e+65535>g.length-1?g.length-1:e+65535),m+=String.fromCharCode.apply(null,k);var g="data:image/"+b+";base64,"+window.btoa(m),q=new Image,l;q.src=g;var p=this;q.onload=function(){p.ctx.clearRect(0,0,d.width,d.height);p.ctx.drawImage(q,0,0);var b=p.ctx.getImageData(0,0,q.width,q.height);l=b.data;if(c)for(e=0;e<c.length;e++)l[4*
e+3]=c[e]?255:0;p.ctx.putImageData(b,0,0);a.resolve(null)};q.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(b){b=new Uint8Array(b,0,10);var c="error";255===b[0]&&216===b[1]?c="jpeg":137===b[0]&&80===b[1]&&78===b[2]&&71===b[3]&&(c="png");return c},_getMask:function(c,d){var a;try{if(!b)throw"The zlib decoder module is not loaded.";var f=0,g=0,m=Math.round(c.length/2);1===m%2&&(m+=1);for(var e=c.length-2,f=m;f<e&&(255!==c[f]||217!==c[f+1]);f++);m=f+=2;if(m<c.length-
1){var k=(new b(c.subarray(m))).getBytes();a=new Uint8Array(d.width*d.height);for(f=c=0;f<k.length;f++)for(g=7;0<=g;g--)a[c++]=k[f]>>g&1}}catch(q){}return a},_loadRasterFormatModule:function(){10>d("ie")||x(["./Zlib"],function(c){b=c})}})})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(x,n,u){var d;return x(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(b){this.stretchType=b.stretchType||b.StretchType||this.stretchType;this.min=b.min||b.Min||this.min;this.max=b.max||b.Max||this.max;this.numberOfStandardDeviations=b.numberOfStandardDeviations||b.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=b.statistics||b.Statistics||this.statistics;this.dra=b.dra||b.DRA||b.dRA||this.dra;this.minPercent=b.minPercent||b.MinPercent||
this.minPercent;this.maxPercent=b.maxPercent||b.MaxPercent||this.maxPercent;this.useGamma=b.useGamma||b.UseGamma||this.useGamma;this.gamma=b.gamma||b.Gamma||this.gamma;this.computeGamma=b.computeGamma||b.ComputeGamma||this.computeGamma;this.raster=b.raster||b.Raster||this.raster;this.outputPixelType=b.outputPixelType||b.OutputPixelType||this.outputPixelType;this.raster=b.raster||b.Raster||this.raster;d=this},filter:function(b){if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=b.pixelBlock,
g=c.pixels,a=c.width*c.height,f=g.length,h;(h=6===d.stretchType||3===d.stretchType&&d.dra)&&d._calculateStatisticsHistograms(b);if(d.dra)if(h)d._statistics=c.statistics,d._histograms=c.histograms;else{var m=c.statistics;d._statistics=[];for(h=0;h<f;h++)d._statistics[h]=[m[h].minValue,m[h].maxValue,0,0]}else d._statistics=d.statistics,d._histograms=d.histograms;d.computeGamma&&(d.gamma=d._computeGammaValues(c.pixelType),d.useGamma=!0);d._createLUT(b);if(void 0===d.LUT||null===d.LUT)return d._filterNoLUT(b);
var m=d.LUT,e=d.LUTOffset,k,q;for(h=0;h<f;h++)for(q=m[h],c=0;c<a;c++)k=g[h][c],g[h][c]=q[k-e];b.pixelBlock.pixelType="U8";return b}},_calculateStatisticsHistograms:function(b){b=b.pixelBlock;var c=b.pixelType,d=b.pixels,a=b.mask,f=d.length,h,m,e,k,q=function(a){this.min=-.5;this.max=255.5;this.size=256;n.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},l=[],p,u,r,t,y,v;for(e=0;e<f;e++){p=new q;u=p.counts;t=d[e];if("U8"===c)if(a)for(k=0;k<b.width*b.height;k++)a[k]&&u[t[k]]++;else for(k=
0;k<b.width*b.height;k++)u[t[k]]++;else{h=b.statistics[e].minValue;m=b.statistics[e].maxValue;p.min=h;p.max=m;m=(m-h)/256;r=new Uint32Array(257);if(a)for(k=0;k<b.width*b.height;k++)a[k]&&r[Math.floor((t[k]-h)/m)]++;else for(k=0;k<b.width*b.height;k++)r[Math.floor((t[k]-h)/m)]++;for(k=0;255>k;k++)u[k]=r[k];u[255]=r[255]+r[256]}l.push(p);t=[];h=b.statistics[e].minValue;m=b.statistics[e].maxValue;for(k=v=y=r=0;k<p.size;k++)r+=u[k],y+=k*u[k];y/=r;for(k=0;k<p.size;k++)v+=u[k]*Math.pow(k-y,2);u=Math.sqrt(v/
(r-1));k=(y+.5)*(p.max-p.min)/p.size+p.min;p=u*(p.max-p.min)/p.size;t.push(h);t.push(m);t.push(k);t.push(p);b.statistics[e]=t}b.histograms=l},_getCutOffPoints:function(b){b=b.pixelBlock.pixels.length;var c=[],g=[],a,f,h,m,e,k;switch(d.stretchType){case 5:for(e=0;e<b;e++)c[e]=d._statistics[e][0],g[e]=d._statistics[e][1];break;case 3:for(e=0;e<b;e++)c[e]=d._statistics[e][2]-d.numberOfStandardDeviations*d._statistics[e][3],g[e]=d._statistics[e][2]+d.numberOfStandardDeviations*d._statistics[e][3],c[e]<
d._statistics[e][0]&&(c[e]=d._statistics[e][0]),g[e]>d._statistics[e][1]&&(g[e]=d._statistics[e][1]);break;case 6:for(e=0;e<b;e++){a=d._histograms[e];m=new Uint32Array(a.size);h=a.counts;for(k=f=0;k<a.size;k++)f+=h[k],m[k]=f;h=d.minPercent*f/100;for(k=1;k<a.size;k++)if(m[k]>h){c[e]=a.min+(a.max-a.min)/a.size*(k-.5);break}h=(1-d.maxPercent/100)*f;for(k=a.size-2;0<=k;k--)if(m[k]<h){g[e]=a.min+(a.max-a.min)/a.size*(k+.5);break}}break;default:for(e=0;e<b;e++)c[e]=0,g[e]=255}return{minCutOff:c,maxCutOff:g}},
_createLUT:function(b){var c=b.pixelBlock,g=c.pixelType;if("U8"===g||"U16"===g||"S8"===g||"S16"===g){if(d._LUTSignature&&(g=d._computeLutSignature(),g.length===d._LUTSignature.length&&!g.some(function(a,b){return a!==d._LUTSignature[b]})))return;var g=c.pixels.length,a=[],f=[],h=[],m,e,k,q=d.max,l=d.min,p=d.gamma,n=q-l,r=d._getCutOffPoints(b);b=r.minCutOff;var r=r.maxCutOff,t=0,u=256,v;"S8"===c.pixelType?t=-127:"S16"===c.pixelType&&(t=-32767);if("U16"===c.pixelType||"S16"===c.pixelType)u=65536;for(c=
0;c<g;c++)a[c]=r[c]-b[c];if(d.useGamma&&null!==p&&p.length===g)for(c=0;c<g;c++)h[c]=1<p[c]?2<p[c]?6.5+Math.pow(p[c]-2,2.5):6.5+100*Math.pow(2-p[c],4):1;if(d.useGamma)for(var x,c=0;c<g;c++){v=[];for(m=0;m<u;m++)e=m+t,x=(e-b[c])/a[c],k=1,1<p[c]&&(k-=Math.pow(1/n,x*h[c])),e<r[c]&&e>b[c]?v[m]=Math.floor(k*n*Math.pow(x,1/p[c]))+l:e>r[c]?v[m]=q:e<b[c]&&(v[m]=l);f[c]=v}else for(c=0;c<g;c++){v=[];for(m=0;m<u;m++)e=m+t,v[m]=e<b[c]?l:e>r[c]?q:Math.floor((e-b[c])/a[c]*n)+l;f[c]=v}d.LUT=f;d.LUTOffset=t;d._LUTSignature=
d._computeLutSignature()}},_computeLutSignature:function(){var b=[],c,g;b.push(d.stretchType);b.push(d.min);b.push(d.max);b.push(d.numberOfStandardDeviations);if(d._statistics)for(c=0;c<d._statistics.length;c++)for(g=0;g<d._statistics[c].length;g++)b.push(d._statistics[c][g]);b.push(d.dra?1:0);b.push(d.minPercent);b.push(d.maxPercent);if(d.gamma)for(c=0;c<d._statistics.length;c++)b.push(d.gamma[c]);b.push(d.useGamma?1:0);return b},_filterNoLUT:function(b){if(null!==b&&null!==b.pixelBlock&&null!==
b.pixelBlock.pixels){var c=b.pixelBlock,g=c.pixels,a=c.mask,c=c.width*c.height,f=g.length,h=[],m=[],e,k,n,l,p,u=d.max,r=d.min,t=d.gamma,y=u-r;e=d._getCutOffPoints(b);var v=e.minCutOff,x=e.maxCutOff;for(e=0;e<f;e++)h[e]=x[e]-v[e];if(d.useGamma&&null!==t&&t.length===f)for(e=0;e<f;e++)m[e]=1<t[e]?2<t[e]?6.5+Math.pow(t[e]-2,2.5):6.5+100*Math.pow(2-t[e],4):1;if(d.useGamma)if(void 0!==a&&null!==a)for(k=0;k<c;k++){if(a[k])for(e=0;e<f;e++)n=g[e][k],p=(n-v[e])/h[e],l=1,1<t[e]&&(l-=Math.pow(1/y,p*m[e])),n<
x[e]&&n>v[e]?g[e][k]=Math.floor(l*y*Math.pow(p,1/t[e]))+r:n>x[e]?g[e][k]=u:n<v[e]&&(g[e][k]=r)}else for(k=0;k<c;k++)for(e=0;e<f;e++)n=g[e][k],p=(n-v[e])/h[e],l=1,1<t[e]&&(l-=Math.pow(1/y,p*m[e])),n<x[e]&&n>v[e]?g[e][k]=Math.floor(l*y*Math.pow(p,1/t[e]))+r:n>x[e]?g[e][k]=u:n<v[e]&&(g[e][k]=r);else if(void 0!==a&&null!==a)for(k=0;k<c;k++){if(a[k])for(e=0;e<f;e++)n=g[e][k],n<x[e]&&n>v[e]?g[e][k]=Math.floor((n-v[e])/h[e]*y)+r:n>x[e]?g[e][k]=u:n<v[e]&&(g[e][k]=r)}else for(k=0;k<c;k++)for(e=0;e<f;e++)n=
g[e][k],n<x[e]&&n>v[e]?g[e][k]=Math.floor((n-v[e])/h[e]*y)+r:n>x[e]?g[e][k]=u:n<v[e]&&(g[e][k]=r);b.pixelBlock.pixelType="U8";return b}},_computeGammaValues:function(b){var c=this._statistics.length,d,a=[],f;for(d=0;d<c;d++)f=this._statistics[d][2],"U8"!==b&&(f=255*(f-this._statistics[d][0])/(this._statistics[d][1]-this._statistics[d][0])),a.push(this._computeGammaValue(f));return a},_computeGammaValue:function(b){if(0!==b&&!(255<b||0>b)){var c=0;0<b&&150!=b&&255>b&&(c=150>=b?45*Math.cos(.01047*b):
17*Math.sin(.021*b));c=Math.log((b+c)/255);if(0!==c&&(b=Math.log(b/255)/c,!isNaN(b)))return Math.min(9.9,Math.max(.01,b))}}})})},"*noref":1}});
define("esri/layers/WCSLayer","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/Deferred dojo/when dojo/io-query dojo/has ../kernel ../request ../deferredUtils ./BaseRasterLayer ./WCSConnection ./Raster ./rasterFormats/ImageCanvasDecoder ./pixelFilters/StretchFilter ../geometry/Extent ../geometry ../graphic".split(" "),function(x,n,u,d,b,c,g,a,f,h,m,e,k,q,l,p,C,r){var t=function(a,b){var c;for(c=0;c<a.length;c++)if(b(a[c]))return c;return-1},y=function(a,b){var c;for(c=0;c<a.length;c++)if(b(a[c]))return a[c]},
v=function(a,b,c){var d;if(c)for(d=0;d<a.length;d++){if(a[d][c].toLowerCase()===b.toLowerCase())return a[d]}else for(d=0;d<a.length;d++)if(a[d].toLowerCase()===b.toLowerCase())return a[d]},I={parse:function(a){var b={isMultiPart:!0,data:null},c=this._getMultiPartHeader(a);c?(b.isMultiPart=!0,b.data=this._getParts(a.data,c)):(b.isMultiPart=!1,b.data=a.data);return b},_getParts:function(a,b){var c=0,d=0,e=c=0,f=[],g=[],h=[],w=[],k;k="--"+b.boundary;for(var l="--"+b.boundary+"\n",m="\n--"+b.boundary+
"--",n=[10],p=[13,10],c=0;c<k.length;c++)g.push(k.charCodeAt(c));for(c=0;c<l.length;c++)h.push(l.charCodeAt(c));for(c=0;c<m.length;c++)w.push(m.charCodeAt(c));h=k.length;a=new Uint8Array(a);k=Math.min(1E4,a.length);for(c=0;c<k;c++)a[c]===g[e]?e===h-1?(e=0,d&&f.push(this._parsePart(a.subarray(d,c+1-h),b)),a[c+1]===n[0]?c+=1:a[c+1]===p[0]&&a[c+2]===p[1]&&(c+=2),d=c+1):e++:e=0;for(c=a.length-w.length-2;c<a.length;c++)if(a[c]===w[e])if(e===w.length-1){e=0;c=c-w.length+1;f.push(this._parsePart(a.subarray(d,
c),b));break}else e++;else e=0;return f},_getMultiPartHeader:function(a){var b,c,d=a.getHeader("Content-Type").split(";");if("multipart/related"===d[0]||"multipart/mixed"===d[0])for(b={boundary:"",start:"",type:""},a=1;a<d.length;a++)c=d[a].split("\x3d"),b[c[0].trim()]=c[1].trim().slice(1,c[1].length-1);return b},_parsePart:function(a,b){var c=String.fromCharCode.apply(null,a.subarray(0,Math.min(300,a.length))).split("\n"),d=0,e=0,f,g=Math.min(c.length,7);f={contentType:null,contentDescription:null,
contentTransferEncoding:null,contentID:null,contentDisposition:null,contentData:null,contentLocation:null};for(var h,w,d=0;d<g;d++)if(4>c[d].length)e=e+c[d].length+1;else if("content"===c[d].slice(0,7).toLowerCase()){if(e=e+c[d].length+1,-1!==c[d].indexOf(":")&&(h=c[d].substring(0,c[d].indexOf(":")).trim(),w=c[d].substring(c[d].indexOf(":")+1).trim(),h))switch(h.toLowerCase()){case "content-type":f.contentType=w;break;case "content-description":f.contentDescription=w;break;case "content-transfer-encoding":f.contentTransferEncoding=
w;break;case "content-id":f.contentID=w;break;case "content-disposition":f.contentDisposition=w;break;case "content-location":f.contentLocation=w}}else if(f.contentDisposition&&4<=c[d].length&&-1<f.contentType.toLowerCase().indexOf("image")){b=new ArrayBuffer(a.length-e);c=new Uint8Array(b);c.set(a.subarray(e,a.length));f.contentData=b;break}else if((""===b.start||f.contentID===b.start)&&f.contentType)if(-1<f.contentType.indexOf("text")){f.contentData=String.fromCharCode.apply(null,a.subarray(e,a.length));
break}else f.contentData=a.subarray(e,a.length);return f}};m=x([m],{declaredClass:"esri.layers.WCSLayer",format:null,interpolation:null,bandIds:null,optionalParameters:null,multidimensionalDefinition:null,projectedFullExtent:null,wcsConnection:null,version:null,coverageId:null,coverageDescription:null,extent:null,timeInfo:null,pixelType:null,_projectedResolution:null,_WEB_MERCATOR:[102100,3857,102113,900913],_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,
2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],
[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_pivotServerGridOrigin110:!1,constructor:function(a,b){this._pixelValueReadPromise=this._rasterReadPromise=null},_initialize:function(a,d){this._params={};x.safeMixin(this,d);this.optionalParameters=this.optionalParameters||{};this.bandIds=this.bandIds||null;a=this.url.indexOf("?");-1<a&&a<=this.url.length-1&&(this.optionalParameters=n.mixin(this.optionalParameters,c.queryToObject(this.url.substring(a+1,this.url.length))),
this.url=this.url.substring(0,a));this.coverageId=this.coverageId||this.coverage||this.identifiers||this.optionalParameters.coverage||this.optionalParameters.coverageId||this.optionalParameters.identifiers;a=n.mixin({},{version:this.version,token:this.token,coverageId:this.coverageId},this.optionalParameters);a=this.wcsConnection||(new e(this.url,a))._connectPromise;b(a,n.hitch(this,this._initialized),this._errorHandler)},_initialized:function(a){var b;this.wcsConnection=a;this.version=this.version||
a.version;this.coverageId=this.coverageId||a.coverages[0].id;var c=v(a.coverages,this.coverageId,"id");this.coverageDescription=c;this.coverageDescription.supportedInterpolations=this.coverageDescription.supportedInterpolations||a.supportedInterpolations;this.extent=this.extent||c.extent;this.timeInfo=c.timeInfo;!this.bandIds&&this.coverageDescription.bandInfo&&(this.bandIds=Object.keys(this.coverageDescription.bandInfo).map(function(a){return parseInt(a,10)}));if((void 0===this.format||null===this.format||
""===this.format||"tiff"===this.format)&&c.supportedFormats)for(b=0;b<c.supportedFormats.length;b++)if(-1<c.supportedFormats[b].toLowerCase().indexOf("tiff")){this.format=c.supportedFormats[b];break}this.format=this.format||"image/tiff";this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();this._params.token=this._getToken();this.loaded=!0;this.onLoad(this);if(a=this._loadCallback)delete this._loadCallback,a(this)},onRasterReadComplete:function(){},setInfoTemplate:function(a){this.infoTemplate=
a},identify:function(a){var b=new d;this._identifyPixelValue(a).then(n.hitch(this,function(a){var c=[];if((this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:1)||"NoData"!==a.value){var d=new r;d.setInfoTemplate(this.infoTemplate);d._layer=this;d.geometry=this.projectedFullExtent;d.attributes={ObjectId:0,"Raster.ServicePixelValue":a.pixelValues.map(function(a){return a.toString()})};
c.push(d)}b.resolve(c)}),n.hitch(this,function(a){b.reject(a)}));return b.promise},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setMap:function(a,b){a.extent?(this.projectedFullExtent=(this.projectedFullExtent=this.projectedFullExtent||this._convertExtentToMap(this.coverageDescription.lonLatEnvelope,a.extent.spatialReference,1E-4))||this._convertExtentToMap(this.coverageDescription.extent,a.extent.spatialReference,1E-4),this._projectedResolution=
this._projectedResolution||{x:(this.projectedFullExtent.xmax-this.projectedFullExtent.xmin)/this.coverageDescription.columns,y:(this.projectedFullExtent.ymax-this.projectedFullExtent.ymin)/this.coverageDescription.rows}):this.projectedFullExtent=this.projectedFullExtent||this.coverageDescription.extent;return this.inherited(arguments)},_convertExtentToNative:function(a){if(!a)return null;var b=null,c=this.coverageDescription.lonLatEnvelope.spatialReference.wkid,d=a.spatialReference.wkid;c===d||-1<
this._WEB_MERCATOR.indexOf(c)&&-1<this._WEB_MERCATOR.indexOf(d)?b=a:4326===c&&-1<this._WEB_MERCATOR.indexOf(d)?b=C.webMercatorUtils.webMercatorToGeographic(a):4326===d&&-1<this._WEB_MERCATOR.indexOf(c)&&(b=C.webMercatorUtils.geographicToWebMercator(a));return b},_convertExtentToMap:function(a,b,c){if(!a)return null;var d=null;b=b?b.wkid:this._map.extent.spatialReference.wkid;var e=a.spatialReference.wkid;b===e||-1<this._WEB_MERCATOR.indexOf(b)&&-1<this._WEB_MERCATOR.indexOf(e)?d=a:4326===b&&-1<this._WEB_MERCATOR.indexOf(e)?
d=C.webMercatorUtils.webMercatorToGeographic(a):4326===e&&-1<this._WEB_MERCATOR.indexOf(b)&&(d=C.webMercatorUtils.geographicToWebMercator(a));d&&d.spatialReference.wkid&&-1<this._WEB_MERCATOR.indexOf(d.spatialReference.wkid)&&(d.spatialReference.wkid=3857);if(c&&d&&d.spatialReference.wkid)if(3857===d.spatialReference.wkid)d.xmin+=c,d.ymin+=c,d.xmax-=c,d.ymax-=c;else if(4326===d.spatialReference.wkid||180>=Math.abs(d.xmin)&&180>=Math.abs(d.xmax))a=1/111111,d.xmin+=c*a,d.ymin+=c*a,d.xmax-=c*a,d.ymax-=
c*a;return d},_constructGetCoverageParams:function(a,b,c,d){var e=this.projectedFullExtent;if(a.xmax<=e.xmin||a.xmin>=e.xmax||a.ymax<=e.ymin||a.ymin>=e.ymax)return null;var f=new p(a);f.xmin=Math.max(f.xmin,e.xmin);f.xmax=Math.min(f.xmax,e.xmax);f.ymin=Math.max(f.ymin,e.ymin);f.ymax=Math.min(f.ymax,e.ymax);var g=this._params;n.mixin(g,{extent:f,width:Math.round((f.xmax-f.xmin)/(a.xmax-a.xmin)*b),height:Math.round((f.ymax-f.ymin)/(a.ymax-a.ymin)*c),crs:"EPSG:"+e.spatialReference.wkid,epsgNSCRS:"urn:ogc:def:crs:EPSG::"+
e.spatialReference.wkid,coverageId:this.coverageId,format:this.format,interpolation:this.interpolation});d&&n.mixin(g,d);g.multidimensionalDefinition||(g.multidimensionalDefinition=this.multidimensionalDefinition);g.interpolation||(this.interpolation?g.interpolation=this.interpolation:this.coverageDescription.supportedInterpolations&&0<this.coverageDescription.supportedInterpolations.length&&(g.interpolation=this.coverageDescription.supportedInterpolations[0]));a=["nearest neighbor","bilinear","bicubic"];
b=["nearest","linear","cubic"];c=["nearest-neighbor","linear","cubic"];if(0===g.interpolation||1===g.interpolation||2===g.interpolation)"1.0.0"===this.version?g.interpolation=a[g.interpolation]:"1.1.0"===this.version||"1.1.1"===this.version||"1.1.2"===this.version?g.interpolation=b[g.interpolation]:"2.0.1"===this.version&&(g.interpolation="http://www.opengis.net/def/interpolation/OGC/1/"+c[g.interpolation]);this.bandIds&&(g.bandIds=this.bandIds.map(n.hitch(this,function(a){return this.coverageDescription.bandInfo[a]})));
!g.time&&this.coverageDescription.timeInfo&&"2.0.1"!==this.version&&(g.time=this.coverageDescription.timeInfo.timeExtent.endTime.toISOString());return g},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();var e=this._constructGetCoverageParams(a,b,c);if(e){var f=this,g=new k("");this._requestExtent=e.extent;var l;this._useBrowserDecoding()&&(a=new q({ctx:this._context}),l=n.hitch(a,"decode"));var m=new d(h._dfdCanceller);m._pendingDfd=this._getCoverage(e);var w,
p,r,u=this._requestExtent;m._pendingDfd.then(function(a){a=I.parse(a);if("1.0.0"===f.version)a=a.data;else if(a.isMultiPart)r=t(a.data,function(a){return null!=a.contentType&&-1<a.contentType.toLowerCase().indexOf("image")}),r=-1===r?a.data.length-1:r,a=a.data[r].contentData;else{p=Error("not a valid multipart coverage response");f._resolve([p],null,n.hitch(f,f._requestDataErrorHandler),m,!0);return}g.decode(a,{width:e.width,height:e.height,planes:null,pixelType:"UNKNOWN",decodeFunc:l}).then(function(a){f.pixelType=
f.pixelType||a.pixelType;if(!f.pixelFilter){var b=f._getDefaultFilter();f.pixelFilter=b.filter;f._pixelFilterArgs=b}w={pixelBlock:a,extent:u};f._resolve([w],"onRasterReadComplete",n.hitch(f,f._requestDataHandler),m,!1)},function(a){f._resolve([a],null,n.hitch(f,f._requestDataErrorHandler),m,!0)})},function(a){f._resolve([a],null,n.hitch(f,f._requestDataErrorHandler),m,!0)});this._rasterReadPromise=m.promise}else this.clear()},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||
(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_useBrowserDecoding:function(){var a=this._requestExtent,b=this._map.width,c=this._map.height,d=this.getCurrentResolution();return Math.round((a.xmax-a.xmin)/d.x)===b&&Math.round((a.ymax-a.ymin)/d.y)===c&&
(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=n.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&h._resDfd(d,a,e)},_getDefaultFilter:function(){var a=0;"U8"!==this.pixelType&&
(a=6);return new l({stretchType:a,min:0,max:255,dRA:!0,minPercent:.2,maxPercent:.2,useGamma:!1})},_getCoverage:function(a){var b=this.version,c=this.coverageDescription,d,e=function(a){return a.toISOString()},g=n.hitch(this,function(){d={request:"GetCoverage",service:"WCS",version:b,coverage:a.coverageId,format:a.format||"GEOTIFF",crs:a.crs,bbox:a.extent.xmin+","+a.extent.ymin+","+a.extent.xmax+","+a.extent.ymax,width:a.width,height:a.height,time:a.time,interpolation:a.interpolation,band:a.bandIds?
a.bandIds.join(","):null}}),h=n.hitch(this,function(){var f,g=this.coverageDescription.nativeCoverageDescription.domain.spatialDomain,h=g.origin.x<=g.envelope.xmin&&g.origin.y<=g.envelope.ymin;f=this._pivotServerGridOrigin110&&h?[(a.extent.xmax-a.extent.xmin)/a.width,(a.extent.ymax-a.extent.ymin)/a.height]:[(a.extent.xmax-a.extent.xmin)/a.width,(a.extent.ymin-a.extent.ymax)/a.height];var k=y(c.nativeCoverageDescription.range,function(a){return a.axis.some(function(a){return"band"===a.identifier.toLowerCase()})}),
l,m,n,g=k&&a.interpolation&&a.bandIds?k.identifier+":"+a.interpolation+"["+k.axis[0].identifier+"["+a.bandIds.join(",")+"]]":null;if(a.multidimensionalDefinition)for(l=0;l<a.multidimensionalDefinition.length;l++)if(n=a.multidimensionalDefinition[l].values,0<n.length)if(-1<a.multidimensionalDefinition[l].dimensionName.toLowerCase().indexOf("time"))n=n.map(e).join(","),a.time=n;else if(k=v(c.nativeCoverageDescription.range,a.multidimensionalDefinition[l].variableName,"identifier"))if(a.interpolation||
(a.interpolation=k.supportedInterpolations[0]),m=v(k.axis,a.multidimensionalDefinition[l].dimensionName,"identifier"))n=n.join(","),g=k.identifier+":"+a.interpolation+"["+m.identifier+"["+n+"]]";k=this._pivotServerGridOrigin110&&h?[a.extent.xmin,a.extent.ymin]:[a.extent.xmin,a.extent.ymax];this.coverageDescription._useEPSGAxis&&this._useLatLong(a.extent.spatialReference.wkid)?(h=a.extent.ymin+","+a.extent.xmin+","+a.extent.ymax+","+a.extent.xmax+","+a.epsgNSCRS,k=k[1]+","+k[0],f=f[1]+","+f[0]):(h=
a.extent.xmin+","+a.extent.ymin+","+a.extent.xmax+","+a.extent.ymax+","+a.epsgNSCRS,k=k[0]+","+k[1],f=f[0]+","+f[1]);d={request:"GetCoverage",service:"WCS",version:b,identifier:a.coverageId,format:a.format||"image/tiff",crs:a.crs,boundingbox:h,GridBaseCRS:a.epsgNSCRS,GridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",GridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",GridOrigin:k,GridOffsets:f,time:a.time,rangeSubset:g}}),k=n.hitch(this,function(){var f=[],g,h,k=c.nativeCoverageDescription.domainSet.axisLabels;
"x"===k[0].toLowerCase()||"x"===k[1].toLowerCase()?(f.push("x,http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.xmin+","+a.extent.xmax+")"),f.push("y,http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.ymin+","+a.extent.ymax+")"),g="x",h="y"):-1<k[0].toLowerCase().indexOf("lat")||-1<k[0].toLowerCase().indexOf("north")?(f.push(k[1]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.xmin+","+a.extent.xmax+
")"),f.push(k[0]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.ymin+","+a.extent.ymax+")"),g=k[1],h=k[0]):-1<k[0].toLowerCase().indexOf("lon")||-1<k[0].toLowerCase().indexOf("east")?(f.push(k[0]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.xmin+","+a.extent.xmax+")"),f.push(k[1]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.ymin+","+a.extent.ymax+")"),g=k[0],h=k[1]):this._useLatLong(a.extent.spatialReference.wkid)?
(f.push(k[1]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.xmin+","+a.extent.xmax+")"),f.push(k[0]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.ymin+","+a.extent.ymax+")"),g=k[1],h=k[0]):(f.push(k[0]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.xmin+","+a.extent.xmax+")"),f.push(k[1]+",http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid+"("+a.extent.ymin+","+
a.extent.ymax+")"),g=k[0],h=k[1]);2<k.length&&(f.push(k[2]+",http://www.opengis.net(2014/04/08 00:00:00)"),f.push(k[3]+",http://www.opengis.net(0)"));var l=null,m,n,p=[],q=[];if(a.multidimensionalDefinition){for(l=0;l<c.nativeCoverageDescription.rangeType.length;l++)q=q.concat(c.nativeCoverageDescription.rangeType[l].map(function(a){return a.name}));for(l=0;l<a.multidimensionalDefinition.length;l++)m=v(k,a.multidimensionalDefinition[l].dimensionName),n=v(q,a.multidimensionalDefinition[l].variableName),
-1===p.indexOf(n)&&p.push(n),m&&(n=a.multidimensionalDefinition[l].values,0<n.length&&(n[0]instanceof Array&&(n=n[0]),n=-1<m.toLowerCase().indexOf("time")?n.map(e).join(","):n.join(","),-1===t(f,function(a){return 0===a.indexOf(m)})&&f.push(m+",http://www.opengis.net("+n+")")));l=0<p.length?p.join(","):null}k="http://www.opengis.net/def/crs/EPSG/0/"+a.extent.spatialReference.wkid;f=f.join("\x26subset\x3d");d={request:"GetCoverage",service:"WCS",version:b,coverageId:a.coverageId,rangesubset:l,interpolation:a.interpolation,
scaleSize:g+"("+a.width+"),"+h+"("+a.height+")",subset:f,extension:null,format:a.format||"image/tiff",outputcrs:k}});switch(b){case "1.0.0":g();break;case "1.1.0":case "1.1.1":case "1.1.2":h();break;case "2.0.1":k()}n.mixin(d,this.optionalParameters);a.token&&(d.token=a.token);var l=this.wcsConnection.onlineResources.getCoverage||this.url;-1===l.indexOf("?")&&(l+="?");Object.keys(d).forEach(function(a){void 0!==d[a]&&null!==d[a]&&(l+=a,l+="\x3d",l+=d[a],l+="\x26")});l=l.substring(0,l.length-1);return f({url:l,
handleAs:"arraybuffer"},{returnFullResponse:!0})},_identifyPixelValue:function(a){var b=new d,c={objectId:0,name:"Pixel",value:null,location:a,pixelValues:null};this._pixelValueReadPromise&&this._pixelValueReadPromise.cancel();var e=this.projectedFullExtent,f=this._projectedResolution,g=e.xmin+Math.floor((a.x-e.xmin)/f.x)*f.x,e=e.ymin+Math.floor((a.y-e.ymin)/f.y)*f.y,l=new p;l.spatialReference=a.spatialReference;l.xmin=g;l.ymin=e;l.xmax=g+2*f.x;l.ymax=e+2*f.y;var m=this._constructGetCoverageParams(l,
2,2),n=this;if(!m)return b.resolve(c),n._pixelValueReadPromise=null,b;var q=new k(""),r;a=new d(h._dfdCanceller);a._pendingDfd=this._getCoverage(m);a._pendingDfd.then(function(a){a=I.parse(a);if("1.0.0"===n.version)a=a.data;else if(a.isMultiPart)a=a.data[a.data.length-1].contentData;else{r=Error("not a valid multipart coverage response");b.reject(r);n._pixelValueReadPromise=null;return}q.decode(a,{width:m.width,height:m.height,planes:null,pixelType:"UNKNOWN"}).then(function(a){a&&a.pixels&&(!a.mask||
a.mask[0]?a.pixels&&(c.pixelValues=a.pixels.map(function(a){return a[0]}),c.value=c.pixelValues.join(" ")):(c.value="NoData",c.pixelValues=[NaN]));b.resolve(c);n._pixelValueReadPromise=null},function(a){b.reject(a);n._pixelValueReadPromise=null})},function(a){b.reject(a);n._pixelValueReadPromise=null});return this._pixelValueReadPromise=b.promise},_useLatLong:function(a){if(!a)return!1;var b,c,d;for(c=0;c<this._REVERSED_LAT_LONG_RANGES.length;c++)if(d=this._REVERSED_LAT_LONG_RANGES[c],a>=d[0]&&a<=
d[1]){b=!0;break}return b},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=u.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(u.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},_setTime:function(a){var b;this._params&&(a?(b=[],a.startTime&&b.push(a.startTime.toISOString()),a.endTime&&b.push(a.endTime.toISOString()),this._params.time=b.join(",")):
this._params.time=null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))}});n.mixin(m,{INTERPOLATION_NEARESTNEIGHBOR:0,INTERPOLATION_BILINEAR:1,INTERPOLATION_CUBICCONVOLUTION:2});g("extend-esri")&&n.setObject("layers.WCSLayer",m,a);return m});